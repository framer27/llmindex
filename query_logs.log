2025-03-08 16:28:17 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:28:17 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:31:41 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:31:41 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:34:18 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:34:18 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:40:21 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:40:21 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:53:05 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:53:05 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:54:09 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 16:54:09 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:02:11 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:02:11 - ERROR - {"type": "query", "status": "error", "query": "统计盘点信息的所有数量", "error": "Statement '统计盘点信息的所有数量' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '统计盘点信息的所有数量'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:03:10 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:05:27 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:10:45 - INFO - 开始构建查询引擎
2025-03-08 17:10:47 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:10:47 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:11:55 - INFO - 开始构建查询引擎
2025-03-08 17:11:58 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:11:58 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:11:58 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:11:58 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:11:58 - DEBUG - 表结构长度: 145328
2025-03-08 17:11:58 - INFO - 查询引擎构建完成
2025-03-08 17:11:58 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:11:58 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:11:58 - DEBUG - 执行查询（缓存）: 显示所有的设备维修记录
2025-03-08 17:11:58 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:13:29 - INFO - 开始构建查询引擎
2025-03-08 17:13:31 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:13:31 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:13:31 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:13:31 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:13:31 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:13:31 - DEBUG - 表结构长度: 145328
2025-03-08 17:13:31 - INFO - 查询引擎构建完成
2025-03-08 17:13:31 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:13:31 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:13:31 - DEBUG - 执行查询（缓存）: 显示所有的设备维修记录
2025-03-08 17:13:31 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Statement '显示所有的设备维修记录' is invalid SQL.\nError: ('42000', \"[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]找不到存储过程 '显示所有的设备维修记录'。 (2812) (SQLExecDirectW)\")", "sql": ""}
2025-03-08 17:15:12 - INFO - 开始构建查询引擎
2025-03-08 17:15:14 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:15:14 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:15:14 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:15:14 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:15:14 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:15:14 - DEBUG - 表结构长度: 145328
2025-03-08 17:15:14 - INFO - 查询引擎构建完成
2025-03-08 17:15:14 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:15:14 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:15:14 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:15:14 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:15:14 - DEBUG - 发送到LLM的提示开头:

        你是一个专业的SQL Server查询助手。请仔细分析以下数据库结构和用户问题，生成准确的SQL查询语句：
        
        数据库表结构说明（包含表名、字段名及其中文含义）：
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- 字段名（Id）: 主键Id 
  英文名称: Id 
  类型: bigint(19) 
  允许空值: 否
- 字段名（Maintain_code）: 维修单号 
  英文名称: Maintain_code 
  类型: nvarchar(200) 
  允许空值: 是
- 字段名（MachineId）: 设备Id 
  英文名称: MachineId 
  类型: bigint(19) 
  允许空值: 是
- 字段名（Machine_code）: 设备编码 
  英文名称: Machine_code 
  类型: nvarchar(200) 
  允许空值: 是
- 字段名（Machine_name）: 设备名称 
  英文名称: Machine_name 
  类型: n...
2025-03-08 17:15:14 - DEBUG - 提示总长度: 145962字符
2025-03-08 17:15:14 - DEBUG - 开始调用LLM...
2025-03-08 17:15:16 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "Error code: 400 - {'error': {'message': \"This model's maximum context length is 65536 tokens. However, you requested 74464 tokens (74464 in the messages, 0 in the completion). Please reduce the length of the messages or completion.\", 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_request_error'}}", "sql": ""}
2025-03-08 17:16:53 - INFO - 开始构建查询引擎
2025-03-08 17:16:55 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:16:55 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:16:55 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:16:55 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:16:55 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:16:55 - DEBUG - 表结构长度: 145328
2025-03-08 17:16:55 - INFO - 查询引擎构建完成
2025-03-08 17:16:55 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:16:55 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:16:55 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:16:55 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:16:55 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:16:55 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:16:55 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:16:55 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:16:55 - DEBUG - 提示总长度: 1134字符
2025-03-08 17:16:55 - DEBUG - 开始调用LLM...
2025-03-08 17:17:10 - DEBUG - LLM返回的原始响应: ```sql
SELECT 
    Id, 
    Maintain_code, 
    MachineId, 
    Machine_code, 
    Machine_name, 
    RepairTime, 
    RepairUserId, 
    RepairImg, 
    FaultDescription, 
    MaintainState, 
    Mai...
2025-03-08 17:17:10 - DEBUG - 提取的SQL: ```sql
SELECT 
    Id, 
    Maintain_code, 
    MachineId, 
    Machine_code, 
    Machine_name, 
    RepairTime, 
    RepairUserId, 
    RepairImg, 
    FaultDescription, 
    MaintainState, 
    MaintainContent, 
    MaintainUserId, 
    MaintainEndTime, 
    MaintenanceTime, 
    CreateTime, 
    UpdateTime, 
    CreateUserId, 
    CreateUserName, 
    UpdateUserId, 
    UpdateUserName, 
    CreateOrgId, 
    CreateOrgName, 
    IsDelete
FROM 
    MesMachineMaintain;
```
2025-03-08 17:17:10 - DEBUG - 开始验证SQL语句安全性: ```sql
SELECT 
    Id, 
    Maintain_code, 
    MachineId, 
    Machine_code, 
    Machine_name, 
    RepairTime, 
    RepairUserId, 
    RepairImg, 
    FaultDescription, 
    MaintainState, 
    MaintainContent, 
    MaintainUserId, 
    MaintainEndTime, 
    MaintenanceTime, 
    CreateTime, 
    UpdateTime, 
    CreateUserId, 
    CreateUserName, 
    UpdateUserId, 
    UpdateUserName, 
    CreateOrgId, 
    CreateOrgName, 
    IsDelete
FROM 
    MesMachineMaintain;
```
2025-03-08 17:17:10 - ERROR - SQL验证失败：非SELECT语句或包含禁用关键字
2025-03-08 17:17:10 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "仅允许SELECT查询，请检查：\n1. 是否误生成存储过程调用\n2. 表名是否正确匹配schema中的表名", "sql": ""}
2025-03-08 17:19:02 - INFO - 开始构建查询引擎
2025-03-08 17:19:04 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:19:04 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:19:04 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:19:04 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:19:04 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:19:04 - DEBUG - 表结构长度: 145328
2025-03-08 17:19:04 - INFO - 查询引擎构建完成
2025-03-08 17:19:04 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:19:04 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:19:04 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:19:04 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:19:04 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:19:04 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:19:04 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:19:04 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:19:04 - DEBUG - 提示总长度: 1134字符
2025-03-08 17:19:04 - DEBUG - 开始调用LLM...
2025-03-08 17:19:20 - DEBUG - LLM返回的原始响应: ```sql
SELECT 
    Id, 
    Maintain_code, 
    MachineId, 
    Machine_code, 
    Machine_name, 
    RepairTime, 
    RepairUserId, 
    RepairImg, 
    FaultDescription, 
    MaintainState, 
    Mai...
2025-03-08 17:19:20 - DEBUG - 开始验证SQL语句安全性: ```sql
SELECT 
    Id, 
    Maintain_code, 
    MachineId, 
    Machine_code, 
    Machine_name, 
    RepairTime, 
    RepairUserId, 
    RepairImg, 
    FaultDescription, 
    MaintainState, 
    MaintainContent, 
    MaintainUserId, 
    MaintainEndTime, 
    MaintenanceTime, 
    CreateTime, 
    UpdateTime, 
    CreateUserId, 
    CreateUserName, 
    UpdateUserId, 
    UpdateUserName, 
    CreateOrgId, 
    CreateOrgName, 
    IsDelete
FROM 
    MesMachineMaintain;
```
2025-03-08 17:19:20 - DEBUG - 清理后的SQL: SELECT 
    Id, 
    Maintain_code, 
    MachineId...
2025-03-08 17:19:20 - ERROR - SQL验证失败：非SELECT语句或包含禁用关键字
2025-03-08 17:19:20 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "仅允许SELECT查询，请检查：\n1. 是否误生成存储过程调用\n2. 表名是否正确匹配schema中的表名", "sql": ""}
2025-03-08 17:20:42 - INFO - 开始构建查询引擎
2025-03-08 17:20:44 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:20:44 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:20:44 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:20:44 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:20:44 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:20:44 - DEBUG - 表结构长度: 145328
2025-03-08 17:20:44 - INFO - 查询引擎构建完成
2025-03-08 17:20:44 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:20:44 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:20:44 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:20:44 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:20:44 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:20:44 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:20:44 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:20:44 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:20:44 - DEBUG - 提示总长度: 1176字符
2025-03-08 17:20:44 - DEBUG - 开始调用LLM...
2025-03-08 17:21:02 - DEBUG - LLM返回的原始响应: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime...
2025-03-08 17:21:02 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:21:02 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:21:02 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:21:02 - ERROR - SQL验证失败：非SELECT语句或包含禁用关键字
2025-03-08 17:21:02 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "仅允许SELECT查询，请检查：\n1. 是否误生成存储过程调用\n2. 表名是否正确匹配schema中的表名", "sql": ""}
2025-03-08 17:22:49 - INFO - 开始构建查询引擎
2025-03-08 17:22:52 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:22:52 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:22:52 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:22:52 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:22:52 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:22:52 - DEBUG - 表结构长度: 145328
2025-03-08 17:22:52 - INFO - 查询引擎构建完成
2025-03-08 17:22:52 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:22:52 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:22:52 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:22:52 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:22:52 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:22:52 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:22:52 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:22:52 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:22:52 - DEBUG - 提示总长度: 1176字符
2025-03-08 17:22:52 - DEBUG - 开始调用LLM...
2025-03-08 17:23:04 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:23:04 - DEBUG - 原始SQL长度: 366字符
2025-03-08 17:23:04 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:23:04 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:23:04 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:23:04 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:23:04 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "cannot access local variable 're' where it is not associated with a value", "sql": ""}
2025-03-08 17:24:07 - INFO - 开始构建查询引擎
2025-03-08 17:24:09 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:24:09 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:24:09 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:24:09 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:24:09 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:24:09 - DEBUG - 表结构长度: 145328
2025-03-08 17:24:09 - INFO - 查询引擎构建完成
2025-03-08 17:24:09 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:24:09 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:24:09 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:24:09 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:24:09 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:24:09 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:24:09 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:24:09 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:24:09 - DEBUG - 提示总长度: 1176字符
2025-03-08 17:24:09 - DEBUG - 开始调用LLM...
2025-03-08 17:24:20 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - 原始SQL长度: 366字符
2025-03-08 17:24:20 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:24:20 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:24:20 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:24:20 - DEBUG - SQL安全性验证通过
2025-03-08 17:24:20 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - 开始执行SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'Maintain_code', 'MachineId', 'Machine_code', 'Machine_name...
2025-03-08 17:24:20 - DEBUG - LLM生成的SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:24:20 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:24:20 - DEBUG - SQL安全性验证通过
2025-03-08 17:24:20 - DEBUG - 开始验证SQL字段: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:24:20 - DEBUG - 检查字段: MesMachineMaintain
2025-03-08 17:24:20 - WARNING - 未找到匹配字段: MesMachineMaintain，但将继续执行
2025-03-08 17:24:20 - DEBUG - 字段验证完成
2025-03-08 17:24:20 - ERROR - {"type": "query", "status": "error", "query": "显示所有的设备维修记录", "error": "replace() argument 1 must be str, not int", "sql": "SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;"}
2025-03-08 17:25:48 - INFO - 开始构建查询引擎
2025-03-08 17:25:50 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:25:50 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:25:50 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:25:50 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:25:50 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:25:50 - DEBUG - 表结构长度: 145328
2025-03-08 17:25:50 - INFO - 查询引擎构建完成
2025-03-08 17:25:50 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:25:50 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:25:50 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:25:50 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:25:50 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:25:50 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:25:50 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:25:50 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:25:50 - DEBUG - 提示总长度: 1176字符
2025-03-08 17:25:50 - DEBUG - 开始调用LLM...
2025-03-08 17:26:01 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - 原始SQL长度: 346字符
2025-03-08 17:26:01 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:26:01 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:26:01 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:26:01 - DEBUG - SQL安全性验证通过
2025-03-08 17:26:01 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - 开始执行SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'Maintain_code', 'MachineId', 'Machine_code', 'Machine_name...
2025-03-08 17:26:01 - DEBUG - LLM生成的SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:26:01 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:26:01 - DEBUG - SQL安全性验证通过
2025-03-08 17:26:01 - DEBUG - 开始验证SQL字段: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:26:01 - DEBUG - 检查字段: MesMachineMaintain
2025-03-08 17:26:01 - WARNING - 未找到匹配字段: MesMachineMaintain，但将继续执行
2025-03-08 17:26:01 - DEBUG - 字段验证完成
2025-03-08 17:26:01 - INFO - {"type": "query", "status": "success", "query": "显示所有的设备维修记录", "sql": "SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain", "result_size": 399}
2025-03-08 17:31:04 - INFO - 开始构建查询引擎
2025-03-08 17:31:07 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:31:07 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:31:07 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:31:07 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:31:07 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:31:07 - DEBUG - 表结构长度: 145328
2025-03-08 17:31:07 - INFO - 查询引擎构建完成
2025-03-08 17:31:07 - INFO - 开始处理查询: 显示所有的客退明细
2025-03-08 17:31:07 - DEBUG - 发送到LLM的查询: 显示所有的客退明细
2025-03-08 17:31:07 - DEBUG - 执行查询: 显示所有的客退明细
2025-03-08 17:31:07 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:31:07 - DEBUG - 为查询选择相关表: 显示所有的客退明细
2025-03-08 17:31:07 - DEBUG - 选择了0个相关表: []
2025-03-08 17:31:07 - DEBUG - 未找到相关表，返回前3个表作为备选
2025-03-08 17:31:07 - DEBUG - 精简后的schema长度: 2138字符
2025-03-08 17:31:07 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:31:07 - DEBUG - 提示总长度: 2467字符
2025-03-08 17:31:07 - DEBUG - 开始调用LLM...
2025-03-08 17:31:20 - DEBUG - LLM返回的原始响应 [完整]: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - 原始SQL长度: 62字符
2025-03-08 17:31:20 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 42, 32, 70, 82, 79, 77, 32, 87, 109, 115, 73, 110, 118]...
2025-03-08 17:31:20 - WARNING - SQL包含非ASCII字符，可能导致解析问题
2025-03-08 17:31:20 - WARNING - 非ASCII字符位置和编码: [(58, '客', 23458), (59, '退', 36864)]
2025-03-08 17:31:20 - DEBUG - 开始验证SQL语句安全性: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - 清理后的SQL: SELECT * FROM WmsInventoryPlan WHERE InventoryPlan...
2025-03-08 17:31:20 - DEBUG - 紧凑的SQL: SELECT * FROM WmsInventoryPlan WHERE InventoryPlan...
2025-03-08 17:31:20 - DEBUG - SQL安全性验证通过
2025-03-08 17:31:20 - DEBUG - 清理并验证后的SQL [完整]: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - 开始执行SQL: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'PlanCode', 'InventoryPlanCode', 'MaterialCode', 'Qnty', 'L...
2025-03-08 17:31:20 - DEBUG - LLM生成的SQL: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - 开始验证SQL语句安全性: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - 清理后的SQL: SELECT * FROM WmsInventoryPlan WHERE InventoryPlan...
2025-03-08 17:31:20 - DEBUG - 紧凑的SQL: SELECT * FROM WmsInventoryPlan WHERE InventoryPlan...
2025-03-08 17:31:20 - DEBUG - SQL安全性验证通过
2025-03-08 17:31:20 - DEBUG - 开始验证SQL字段: SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';
2025-03-08 17:31:20 - DEBUG - 检查字段: WmsInventoryPlan
2025-03-08 17:31:20 - WARNING - 未找到匹配字段: WmsInventoryPlan，但将继续执行
2025-03-08 17:31:20 - DEBUG - 字段验证完成
2025-03-08 17:31:20 - INFO - {"type": "query", "status": "success", "query": "显示所有的客退明细", "sql": "SELECT * FROM WmsInventoryPlan WHERE InventoryPlanType = '客退';", "result_size": 353}
2025-03-08 17:32:37 - INFO - 开始构建查询引擎
2025-03-08 17:32:40 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:32:40 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:32:40 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:32:40 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:32:40 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:32:40 - DEBUG - 表结构长度: 145328
2025-03-08 17:32:40 - INFO - 查询引擎构建完成
2025-03-08 17:32:40 - INFO - 开始处理查询: 显示所有的客退明细信息
2025-03-08 17:32:40 - DEBUG - 发送到LLM的查询: 显示所有的客退明细信息
2025-03-08 17:32:40 - DEBUG - 执行查询: 显示所有的客退明细信息
2025-03-08 17:32:40 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:32:40 - DEBUG - 为查询选择相关表: 显示所有的客退明细信息
2025-03-08 17:32:40 - DEBUG - 选择了0个相关表: []
2025-03-08 17:32:40 - DEBUG - 未找到相关表，返回前3个表作为备选
2025-03-08 17:32:40 - DEBUG - 精简后的schema长度: 2138字符
2025-03-08 17:32:40 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:32:40 - DEBUG - 提示总长度: 2469字符
2025-03-08 17:32:40 - DEBUG - 开始调用LLM...
2025-03-08 17:32:58 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - 原始SQL长度: 365字符
2025-03-08 17:32:58 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:32:58 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:32:58 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:32:58 - DEBUG - SQL安全性验证通过
2025-03-08 17:32:58 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - 开始执行SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'Maintain_code', 'MachineId', 'Machine_code', 'Machine_name...
2025-03-08 17:32:58 - DEBUG - LLM生成的SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:32:58 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:32:58 - DEBUG - SQL安全性验证通过
2025-03-08 17:32:58 - DEBUG - 开始验证SQL字段: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0
2025-03-08 17:32:58 - DEBUG - 检查字段: MesMachineMaintain
2025-03-08 17:32:58 - WARNING - 未找到匹配字段: MesMachineMaintain，但将继续执行
2025-03-08 17:32:58 - DEBUG - 字段验证完成
2025-03-08 17:32:58 - INFO - {"type": "query", "status": "success", "query": "显示所有的客退明细信息", "sql": "SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0", "result_size": 399}
2025-03-08 17:36:03 - INFO - 开始构建查询引擎
2025-03-08 17:36:05 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:36:05 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:36:05 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:36:05 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:36:05 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:36:05 - DEBUG - 表结构长度: 145328
2025-03-08 17:36:05 - INFO - 查询引擎构建完成
2025-03-08 17:36:05 - INFO - 开始处理查询: 查询所有的送货单明细信息
2025-03-08 17:36:05 - DEBUG - 发送到LLM的查询: 查询所有的送货单明细信息
2025-03-08 17:36:05 - DEBUG - 执行查询: 查询所有的送货单明细信息
2025-03-08 17:36:05 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:36:05 - DEBUG - 为查询选择相关表: 查询所有的送货单明细信息
2025-03-08 17:36:05 - DEBUG - 选择了0个相关表: []
2025-03-08 17:36:05 - DEBUG - 未找到相关表，返回前3个表作为备选
2025-03-08 17:36:05 - DEBUG - 精简后的schema长度: 2138字符
2025-03-08 17:36:05 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:36:05 - DEBUG - 提示总长度: 2470字符
2025-03-08 17:36:05 - DEBUG - 开始调用LLM...
2025-03-08 17:36:17 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - 原始SQL长度: 319字符
2025-03-08 17:36:17 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 80, 108, 97, 110, 67, 111, 100, 101, 44]...
2025-03-08 17:36:17 - DEBUG - 开始验证SQL语句安全性: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - 清理后的SQL: SELECT Id, PlanCode, InventoryPlanCode, MaterialCo...
2025-03-08 17:36:17 - DEBUG - 紧凑的SQL: SELECT Id, PlanCode, InventoryPlanCode, MaterialCo...
2025-03-08 17:36:17 - DEBUG - SQL安全性验证通过
2025-03-08 17:36:17 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - 开始执行SQL: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'PlanCode', 'InventoryPlanCode', 'MaterialCode', 'Qnty', 'L...
2025-03-08 17:36:17 - DEBUG - LLM生成的SQL: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - 开始验证SQL语句安全性: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - 清理后的SQL: SELECT Id, PlanCode, InventoryPlanCode, MaterialCo...
2025-03-08 17:36:17 - DEBUG - 紧凑的SQL: SELECT Id, PlanCode, InventoryPlanCode, MaterialCo...
2025-03-08 17:36:17 - DEBUG - SQL安全性验证通过
2025-03-08 17:36:17 - DEBUG - 开始验证SQL字段: SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0
2025-03-08 17:36:17 - DEBUG - 检查字段: WmsInventoryPlan
2025-03-08 17:36:17 - WARNING - 未找到匹配字段: WmsInventoryPlan，但将继续执行
2025-03-08 17:36:17 - DEBUG - 字段验证完成
2025-03-08 17:36:17 - INFO - {"type": "query", "status": "success", "query": "查询所有的送货单明细信息", "sql": "SELECT Id, PlanCode, InventoryPlanCode, MaterialCode, Qnty, LotNo, PostID, StockType, InventoryPlanType, InventoryPlanQnty, InventoryPlanMan, Bstate, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsInventoryPlan WHERE IsDelete = 0", "result_size": 353}
2025-03-08 17:40:03 - INFO - 开始构建查询引擎
2025-03-08 17:40:05 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:40:05 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:40:05 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:40:05 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:40:05 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:40:05 - DEBUG - 表结构长度: 145328
2025-03-08 17:40:05 - INFO - 查询引擎构建完成
2025-03-08 17:40:05 - INFO - 开始处理查询: 查询所有的送货单明细信息
2025-03-08 17:40:05 - DEBUG - 发送到LLM的查询: 查询所有的送货单明细信息
2025-03-08 17:40:05 - DEBUG - 执行查询: 查询所有的送货单明细信息
2025-03-08 17:40:05 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:40:05 - DEBUG - 为查询选择相关表: 查询所有的送货单明细信息
2025-03-08 17:40:05 - DEBUG - 找到直接相关的表(送货单明细): ['WmsDeliverynoteDetail']
2025-03-08 17:40:05 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:40:05 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- Produce...
2025-03-08 17:40:05 - DEBUG - 提示总长度: 1335字符
2025-03-08 17:40:05 - DEBUG - 开始调用LLM...
2025-03-08 17:40:21 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - 原始SQL长度: 398字符
2025-03-08 17:40:21 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 17:40:21 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:21 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:21 - DEBUG - SQL安全性验证通过
2025-03-08 17:40:21 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:40:21 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:21 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:21 - DEBUG - SQL安全性验证通过
2025-03-08 17:40:21 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:21 - DEBUG - 检查字段: WmsDeliverynoteDetail
2025-03-08 17:40:21 - WARNING - 未找到匹配字段: WmsDeliverynoteDetail，但将继续执行
2025-03-08 17:40:21 - DEBUG - 字段验证完成
2025-03-08 17:40:21 - INFO - {"type": "query", "status": "success", "query": "查询所有的送货单明细信息", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 12724}
2025-03-08 17:40:21 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:40:21 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:40:21 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:40:21 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:40:21 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:40:21 - DEBUG - 找到直接相关的表: ['MesMachineMaintain']
2025-03-08 17:40:21 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:40:21 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))...
2025-03-08 17:40:21 - DEBUG - 提示总长度: 1176字符
2025-03-08 17:40:21 - DEBUG - 开始调用LLM...
2025-03-08 17:40:38 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - 原始SQL长度: 346字符
2025-03-08 17:40:38 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:40:38 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:40:38 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:40:38 - DEBUG - SQL安全性验证通过
2025-03-08 17:40:38 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - 开始执行SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'Maintain_code', 'MachineId', 'Machine_code', 'Machine_name...
2025-03-08 17:40:38 - DEBUG - LLM生成的SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:40:38 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:40:38 - DEBUG - SQL安全性验证通过
2025-03-08 17:40:38 - DEBUG - 开始验证SQL字段: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain
2025-03-08 17:40:38 - DEBUG - 检查字段: MesMachineMaintain
2025-03-08 17:40:38 - WARNING - 未找到匹配字段: MesMachineMaintain，但将继续执行
2025-03-08 17:40:38 - DEBUG - 字段验证完成
2025-03-08 17:40:38 - INFO - {"type": "query", "status": "success", "query": "显示所有的设备维修记录", "sql": "SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain", "result_size": 399}
2025-03-08 17:40:38 - INFO - 开始处理查询: 送货单明细查询
2025-03-08 17:40:38 - DEBUG - 发送到LLM的查询: 送货单明细查询
2025-03-08 17:40:38 - DEBUG - 执行查询: 送货单明细查询
2025-03-08 17:40:38 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:40:38 - DEBUG - 为查询选择相关表: 送货单明细查询
2025-03-08 17:40:38 - DEBUG - 找到直接相关的表(送货单明细): ['WmsDeliverynoteDetail']
2025-03-08 17:40:38 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:40:38 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- Produce...
2025-03-08 17:40:38 - DEBUG - 提示总长度: 1330字符
2025-03-08 17:40:38 - DEBUG - 开始调用LLM...
2025-03-08 17:40:52 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - 原始SQL长度: 398字符
2025-03-08 17:40:52 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 17:40:52 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:52 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:52 - DEBUG - SQL安全性验证通过
2025-03-08 17:40:52 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:40:52 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:52 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:40:52 - DEBUG - SQL安全性验证通过
2025-03-08 17:40:52 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:40:52 - DEBUG - 检查字段: WmsDeliverynoteDetail
2025-03-08 17:40:52 - WARNING - 未找到匹配字段: WmsDeliverynoteDetail，但将继续执行
2025-03-08 17:40:52 - DEBUG - 字段验证完成
2025-03-08 17:40:52 - INFO - {"type": "query", "status": "success", "query": "送货单明细查询", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 12724}
2025-03-08 17:44:36 - INFO - 开始构建查询引擎
2025-03-08 17:44:38 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:44:38 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:44:38 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:44:38 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:44:38 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:44:38 - DEBUG - 表结构长度: 145328
2025-03-08 17:44:38 - INFO - 查询引擎构建完成
2025-03-08 17:44:38 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 17:44:38 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 17:44:38 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 17:44:38 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:44:38 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 17:44:38 - DEBUG - 找到直接相关的表(送货单明细): ['WmsDeliverynoteDetail']
2025-03-08 17:44:38 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:44:38 - DEBUG - 发送到LLM的提示开头:

        你是SQL专家，将以下自然语言问题转换为SQL Server查询语句。
        
        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- Produce...
2025-03-08 17:44:38 - DEBUG - 提示总长度: 1336字符
2025-03-08 17:44:38 - DEBUG - 开始调用LLM...
2025-03-08 17:44:50 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - 原始SQL长度: 404字符
2025-03-08 17:44:50 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 17:44:50 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:44:50 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:44:50 - DEBUG - SQL安全性验证通过
2025-03-08 17:44:50 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:44:50 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:44:50 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:44:50 - DEBUG - SQL安全性验证通过
2025-03-08 17:44:50 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:44:50 - DEBUG - 检查字段: TOP
2025-03-08 17:44:50 - WARNING - 未找到匹配字段: TOP，但将继续执行
2025-03-08 17:44:50 - DEBUG - 检查字段: WmsDeliverynoteDetail
2025-03-08 17:44:50 - WARNING - 未找到匹配字段: WmsDeliverynoteDetail，但将继续执行
2025-03-08 17:44:50 - DEBUG - 字段验证完成
2025-03-08 17:44:50 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 17:49:51 - INFO - 开始构建查询引擎
2025-03-08 17:49:54 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:49:54 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:49:54 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:49:54 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:49:54 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:49:54 - DEBUG - 表结构长度: 145328
2025-03-08 17:49:54 - INFO - 查询引擎构建完成
2025-03-08 17:49:54 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 17:49:54 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 17:49:54 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 17:49:54 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:49:54 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 17:49:54 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:49:54 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:49:54 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:49:54 - DEBUG - 提示总长度: 1428字符
2025-03-08 17:49:54 - DEBUG - 开始调用LLM...
2025-03-08 17:50:05 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - 原始SQL长度: 404字符
2025-03-08 17:50:05 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 17:50:05 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:50:05 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:50:05 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:05 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:50:05 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:50:05 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:50:05 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:05 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:50:05 - DEBUG - 字段验证完成
2025-03-08 17:50:05 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 17:50:05 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:50:05 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:50:05 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:50:05 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:50:05 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:50:05 - DEBUG - 通过关键词"设备维修"直接匹配到表: MesMachineMaintain
2025-03-08 17:50:05 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:50:05 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))
- Main...
2025-03-08 17:50:05 - DEBUG - 提示总长度: 1268字符
2025-03-08 17:50:05 - DEBUG - 开始调用LLM...
2025-03-08 17:50:16 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - 原始SQL长度: 366字符
2025-03-08 17:50:16 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:50:16 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:50:16 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:50:16 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:16 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - 开始执行SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'Maintain_code', 'MachineId', 'Machine_code', 'Machine_name...
2025-03-08 17:50:16 - DEBUG - LLM生成的SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:50:16 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:50:16 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:16 - DEBUG - 开始验证SQL字段: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;
2025-03-08 17:50:16 - DEBUG - 字段验证完成
2025-03-08 17:50:16 - INFO - {"type": "query", "status": "success", "query": "显示所有的设备维修记录", "sql": "SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM MesMachineMaintain WHERE IsDelete = 0;", "result_size": 399}
2025-03-08 17:50:16 - INFO - 开始处理查询: 送货单明细查询
2025-03-08 17:50:16 - DEBUG - 发送到LLM的查询: 送货单明细查询
2025-03-08 17:50:16 - DEBUG - 执行查询: 送货单明细查询
2025-03-08 17:50:16 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:50:16 - DEBUG - 为查询选择相关表: 送货单明细查询
2025-03-08 17:50:16 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:50:16 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:50:16 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:50:16 - DEBUG - 提示总长度: 1422字符
2025-03-08 17:50:16 - DEBUG - 开始调用LLM...
2025-03-08 17:50:38 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - 原始SQL长度: 418字符
2025-03-08 17:50:38 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 17:50:38 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:50:38 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:50:38 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:38 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:50:38 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:50:38 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:50:38 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:38 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:50:38 - DEBUG - 字段验证完成
2025-03-08 17:50:38 - INFO - {"type": "query", "status": "success", "query": "送货单明细查询", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE IsDelete = 0;", "result_size": 9664}
2025-03-08 17:50:38 - INFO - 开始处理查询: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:50:38 - DEBUG - 发送到LLM的查询: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:50:38 - DEBUG - 执行查询: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:50:38 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:50:38 - DEBUG - 为查询选择相关表: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:50:38 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:50:38 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:50:38 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:50:38 - DEBUG - 提示总长度: 1437字符
2025-03-08 17:50:38 - DEBUG - 开始调用LLM...
2025-03-08 17:50:46 - DEBUG - LLM返回的原始响应 [完整]: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - 原始SQL长度: 69字符
2025-03-08 17:50:46 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 42, 32, 70, 82, 79, 77, 32, 87, 109, 115, 68, 101, 108]...
2025-03-08 17:50:46 - DEBUG - 开始验证SQL语句安全性: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - 清理后的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:50:46 - DEBUG - 紧凑的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:50:46 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:46 - DEBUG - 清理并验证后的SQL [完整]: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - 开始执行SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:50:46 - DEBUG - LLM生成的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - 开始验证SQL语句安全性: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - 清理后的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:50:46 - DEBUG - 紧凑的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:50:46 - DEBUG - SQL安全性验证通过
2025-03-08 17:50:46 - DEBUG - 开始验证SQL字段: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:50:46 - DEBUG - 字段验证完成
2025-03-08 17:50:46 - INFO - {"type": "query", "status": "success", "query": "查询生产日期在2024年1月之后的送货单明细", "sql": "SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';", "result_size": 11406}
2025-03-08 17:52:08 - INFO - 开始构建查询引擎
2025-03-08 17:52:10 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:52:10 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:52:10 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:52:10 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:52:10 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:52:10 - DEBUG - 表结构长度: 145328
2025-03-08 17:52:10 - INFO - 查询引擎构建完成
2025-03-08 17:52:10 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 17:52:10 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 17:52:10 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 17:52:10 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:52:10 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 17:52:10 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:52:10 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:52:10 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:52:10 - DEBUG - 提示总长度: 1428字符
2025-03-08 17:52:10 - DEBUG - 开始调用LLM...
2025-03-08 17:52:24 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - 原始SQL长度: 404字符
2025-03-08 17:52:24 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 17:52:24 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:52:24 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:52:24 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:24 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:52:24 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:52:24 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:52:24 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:24 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:52:24 - DEBUG - 字段验证完成
2025-03-08 17:52:24 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 17:52:24 - INFO - 开始处理查询: 显示所有的设备维修记录
2025-03-08 17:52:24 - DEBUG - 发送到LLM的查询: 显示所有的设备维修记录
2025-03-08 17:52:24 - DEBUG - 执行查询: 显示所有的设备维修记录
2025-03-08 17:52:24 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:52:24 - DEBUG - 为查询选择相关表: 显示所有的设备维修记录
2025-03-08 17:52:24 - DEBUG - 通过关键词"设备维修"直接匹配到表: MesMachineMaintain
2025-03-08 17:52:24 - DEBUG - 精简后的schema长度: 845字符
2025-03-08 17:52:24 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：MesMachineMaintain
表说明：设备维修记录

字段列表：
- Id: 主键Id (bigint(19))
- Maintain_code: 维修单号 (nvarchar(200))
- MachineId: 设备Id (bigint(19))
- Machine_code: 设备编码 (nvarchar(200))
- Machine_name: 设备名称 (nvarchar(200))
- RepairTime: 报修时间 (datetime)
- RepairUserId: 报修人员 (nvarchar(200))
- RepairImg: 维修图片 (nvarchar(500))
- FaultDescription: 故障描述 (nvarchar(1000))
- MaintainState: 维修状态 (int(10))
- MaintainContent: 维保内容 (nvarchar(1000))
- Main...
2025-03-08 17:52:24 - DEBUG - 提示总长度: 1268字符
2025-03-08 17:52:24 - DEBUG - 开始调用LLM...
2025-03-08 17:52:36 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - 原始SQL长度: 366字符
2025-03-08 17:52:36 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 77, 97, 105, 110, 116, 97, 105, 110, 95]...
2025-03-08 17:52:36 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:52:36 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:52:36 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:36 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - 开始执行SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - SQL执行结果: ('[]', {'result': [], 'col_keys': ['Id', 'Maintain_code', 'MachineId', 'Machine_code', 'Machine_name...
2025-03-08 17:52:36 - DEBUG - LLM生成的SQL: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - 开始验证SQL语句安全性: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - 清理后的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:52:36 - DEBUG - 紧凑的SQL: SELECT Id, Maintain_code, MachineId, Machine_code,...
2025-03-08 17:52:36 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:36 - DEBUG - 开始验证SQL字段: SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM MesMachineMaintain
WHERE IsDelete = 0;
2025-03-08 17:52:36 - DEBUG - 字段验证完成
2025-03-08 17:52:36 - INFO - {"type": "query", "status": "success", "query": "显示所有的设备维修记录", "sql": "SELECT Id, Maintain_code, MachineId, Machine_code, Machine_name, RepairTime, RepairUserId, RepairImg, FaultDescription, MaintainState, MaintainContent, MaintainUserId, MaintainEndTime, MaintenanceTime, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM MesMachineMaintain\nWHERE IsDelete = 0;", "result_size": 399}
2025-03-08 17:52:36 - INFO - 开始处理查询: 送货单明细查询
2025-03-08 17:52:36 - DEBUG - 发送到LLM的查询: 送货单明细查询
2025-03-08 17:52:36 - DEBUG - 执行查询: 送货单明细查询
2025-03-08 17:52:36 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:52:36 - DEBUG - 为查询选择相关表: 送货单明细查询
2025-03-08 17:52:36 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:52:36 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:52:36 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:52:36 - DEBUG - 提示总长度: 1422字符
2025-03-08 17:52:36 - DEBUG - 开始调用LLM...
2025-03-08 17:52:48 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - 原始SQL长度: 418字符
2025-03-08 17:52:48 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 17:52:48 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:52:48 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:52:48 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:48 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:52:48 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:52:48 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 17:52:48 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:48 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE IsDelete = 0;
2025-03-08 17:52:48 - DEBUG - 字段验证完成
2025-03-08 17:52:48 - INFO - {"type": "query", "status": "success", "query": "送货单明细查询", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE IsDelete = 0;", "result_size": 9664}
2025-03-08 17:52:48 - INFO - 开始处理查询: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:52:48 - DEBUG - 发送到LLM的查询: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:52:48 - DEBUG - 执行查询: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:52:48 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:52:48 - DEBUG - 为查询选择相关表: 查询生产日期在2024年1月之后的送货单明细
2025-03-08 17:52:48 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:52:48 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:52:48 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:52:48 - DEBUG - 提示总长度: 1437字符
2025-03-08 17:52:48 - DEBUG - 开始调用LLM...
2025-03-08 17:52:56 - DEBUG - LLM返回的原始响应 [完整]: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - 原始SQL长度: 69字符
2025-03-08 17:52:56 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 42, 32, 70, 82, 79, 77, 32, 87, 109, 115, 68, 101, 108]...
2025-03-08 17:52:56 - DEBUG - 开始验证SQL语句安全性: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - 清理后的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:52:56 - DEBUG - 紧凑的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:52:56 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:56 - DEBUG - 清理并验证后的SQL [完整]: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - 开始执行SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:52:56 - DEBUG - LLM生成的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - 开始验证SQL语句安全性: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - 清理后的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:52:56 - DEBUG - 紧凑的SQL: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceT...
2025-03-08 17:52:56 - DEBUG - SQL安全性验证通过
2025-03-08 17:52:56 - DEBUG - 开始验证SQL字段: SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';
2025-03-08 17:52:56 - DEBUG - 字段验证完成
2025-03-08 17:52:56 - INFO - {"type": "query", "status": "success", "query": "查询生产日期在2024年1月之后的送货单明细", "sql": "SELECT * FROM WmsDeliverynoteDetail WHERE ProduceTime > '2024-01-01';", "result_size": 11406}
2025-03-08 17:53:36 - INFO - 开始构建查询引擎
2025-03-08 17:53:38 - DEBUG - 加载的schema长度: 145328
2025-03-08 17:53:38 - DEBUG - 创建的表schema数量: 106
2025-03-08 17:53:38 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 17:53:38 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 17:53:38 - DEBUG - LLM模型: DeepSeek
2025-03-08 17:53:38 - DEBUG - 表结构长度: 145328
2025-03-08 17:53:38 - INFO - 查询引擎构建完成
2025-03-08 17:53:38 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 17:53:38 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 17:53:38 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 17:53:38 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 17:53:38 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 17:53:38 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 17:53:38 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 17:53:38 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 17:53:38 - DEBUG - 提示总长度: 1428字符
2025-03-08 17:53:38 - DEBUG - 开始调用LLM...
2025-03-08 17:53:50 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - 原始SQL长度: 404字符
2025-03-08 17:53:50 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 17:53:50 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:53:50 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:53:50 - DEBUG - SQL安全性验证通过
2025-03-08 17:53:50 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 17:53:50 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:53:50 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 17:53:50 - DEBUG - SQL安全性验证通过
2025-03-08 17:53:50 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 17:53:50 - DEBUG - 字段验证完成
2025-03-08 17:53:50 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 18:00:39 - INFO - 开始构建查询引擎
2025-03-08 18:00:41 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:00:41 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:00:41 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:00:41 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:00:41 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:00:41 - DEBUG - 表结构长度: 145328
2025-03-08 18:00:41 - INFO - 查询引擎构建完成
2025-03-08 18:00:41 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 18:00:41 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 18:00:41 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 18:00:41 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:00:41 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 18:00:41 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:00:41 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:00:41 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:00:41 - DEBUG - 提示总长度: 1428字符
2025-03-08 18:00:41 - DEBUG - 开始调用LLM...
2025-03-08 18:00:57 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - 原始SQL长度: 404字符
2025-03-08 18:00:57 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 18:00:57 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:00:57 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:00:57 - DEBUG - SQL安全性验证通过
2025-03-08 18:00:57 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:00:57 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:00:57 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:00:57 - DEBUG - SQL安全性验证通过
2025-03-08 18:00:57 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:00:57 - DEBUG - 字段验证完成
2025-03-08 18:00:57 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 18:05:49 - INFO - 开始构建查询引擎
2025-03-08 18:05:49 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:05:49 - INFO - 开始从头构建查询引擎
2025-03-08 18:05:51 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:05:51 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:05:51 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:05:51 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:05:51 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x000001F05A76A020>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:05:51 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:05:51 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:05:51 - DEBUG - 表结构长度: 145328
2025-03-08 18:05:51 - INFO - 查询引擎构建完成，耗时: 1.99秒
2025-03-08 18:05:51 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 18:05:51 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 18:05:51 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 18:05:51 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:05:51 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 18:05:51 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:05:51 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:05:51 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:05:51 - DEBUG - 提示总长度: 1428字符
2025-03-08 18:05:51 - DEBUG - 开始调用LLM...
2025-03-08 18:06:03 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - 原始SQL长度: 404字符
2025-03-08 18:06:03 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 18:06:03 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:03 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:03 - DEBUG - SQL安全性验证通过
2025-03-08 18:06:03 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:06:03 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:03 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:03 - DEBUG - SQL安全性验证通过
2025-03-08 18:06:03 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:03 - DEBUG - 字段验证完成
2025-03-08 18:06:03 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 18:06:19 - INFO - 开始构建查询引擎
2025-03-08 18:06:19 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:06:19 - INFO - 开始从头构建查询引擎
2025-03-08 18:06:21 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:06:21 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:06:21 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:06:21 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:06:21 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x000002679BA3A0C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:06:21 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:06:21 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:06:21 - DEBUG - 表结构长度: 145328
2025-03-08 18:06:21 - INFO - 查询引擎构建完成，耗时: 2.77秒
2025-03-08 18:06:21 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 18:06:21 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 18:06:21 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 18:06:21 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:06:21 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 18:06:21 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:06:21 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:06:21 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:06:21 - DEBUG - 提示总长度: 1428字符
2025-03-08 18:06:21 - DEBUG - 开始调用LLM...
2025-03-08 18:06:32 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - 原始SQL长度: 404字符
2025-03-08 18:06:32 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 18:06:32 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:32 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:32 - DEBUG - SQL安全性验证通过
2025-03-08 18:06:32 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:06:32 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:32 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:06:32 - DEBUG - SQL安全性验证通过
2025-03-08 18:06:32 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:06:32 - DEBUG - 字段验证完成
2025-03-08 18:06:32 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 18:06:59 - INFO - 开始构建查询引擎
2025-03-08 18:06:59 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:06:59 - INFO - 开始从头构建查询引擎
2025-03-08 18:07:00 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:07:00 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:07:00 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:07:00 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:07:00 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x000001907E4FA0C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:07:00 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:07:00 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:07:00 - DEBUG - 表结构长度: 145328
2025-03-08 18:07:00 - INFO - 查询引擎构建完成，耗时: 1.81秒
2025-03-08 18:07:00 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 18:07:00 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 18:07:00 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 18:07:00 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:07:00 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 18:07:00 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:07:00 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:07:00 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:07:00 - DEBUG - 提示总长度: 1428字符
2025-03-08 18:07:00 - DEBUG - 开始调用LLM...
2025-03-08 18:07:18 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - 原始SQL长度: 404字符
2025-03-08 18:07:18 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 18:07:18 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:18 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:18 - DEBUG - SQL安全性验证通过
2025-03-08 18:07:18 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:07:18 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:18 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:18 - DEBUG - SQL安全性验证通过
2025-03-08 18:07:18 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:18 - DEBUG - 字段验证完成
2025-03-08 18:07:18 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 18:07:36 - INFO - 开始构建查询引擎
2025-03-08 18:07:36 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:07:36 - INFO - 开始从头构建查询引擎
2025-03-08 18:07:38 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:07:38 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:07:38 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:07:38 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:07:38 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x000001EBED3560C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:07:38 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:07:38 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:07:38 - DEBUG - 表结构长度: 145328
2025-03-08 18:07:38 - INFO - 查询引擎构建完成，耗时: 1.91秒
2025-03-08 18:07:38 - INFO - 开始处理查询: 查询前两条的送货单明细信息
2025-03-08 18:07:38 - DEBUG - 发送到LLM的查询: 查询前两条的送货单明细信息
2025-03-08 18:07:38 - DEBUG - 执行查询: 查询前两条的送货单明细信息
2025-03-08 18:07:38 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:07:38 - DEBUG - 为查询选择相关表: 查询前两条的送货单明细信息
2025-03-08 18:07:38 - DEBUG - 通过关键词"送货单"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:07:38 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:07:38 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:07:38 - DEBUG - 提示总长度: 1428字符
2025-03-08 18:07:38 - DEBUG - 开始调用LLM...
2025-03-08 18:07:57 - DEBUG - LLM返回的原始响应 [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - 原始SQL长度: 404字符
2025-03-08 18:07:57 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 84, 79, 80, 32, 50, 32, 73, 100, 44, 32, 68, 101, 108]...
2025-03-08 18:07:57 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:57 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:57 - DEBUG - SQL安全性验证通过
2025-03-08 18:07:57 - DEBUG - 清理并验证后的SQL [完整]: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - 开始执行SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:07:57 - DEBUG - LLM生成的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - 开始验证SQL语句安全性: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - 清理后的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:57 - DEBUG - 紧凑的SQL: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, Produ...
2025-03-08 18:07:57 - DEBUG - SQL安全性验证通过
2025-03-08 18:07:57 - DEBUG - 开始验证SQL字段: SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail
2025-03-08 18:07:57 - DEBUG - 字段验证完成
2025-03-08 18:07:57 - INFO - {"type": "query", "status": "success", "query": "查询前两条的送货单明细信息", "sql": "SELECT TOP 2 Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete FROM WmsDeliverynoteDetail", "result_size": 2126}
2025-03-08 18:08:54 - INFO - 开始构建查询引擎
2025-03-08 18:08:54 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:08:54 - INFO - 开始从头构建查询引擎
2025-03-08 18:08:56 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:08:56 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:08:56 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:08:56 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:08:56 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x000001B39DC960C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:08:56 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:08:56 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:08:56 - DEBUG - 表结构长度: 145328
2025-03-08 18:08:56 - INFO - 查询引擎构建完成，耗时: 1.97秒
2025-03-08 18:08:56 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:08:56 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:08:56 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:08:56 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:08:56 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:08:56 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:08:56 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:08:56 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:08:56 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:08:56 - DEBUG - 开始调用LLM...
2025-03-08 18:09:15 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:09:15 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:09:15 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:09:15 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:09:15 - DEBUG - SQL安全性验证通过
2025-03-08 18:09:15 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:09:15 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:09:15 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:09:15 - DEBUG - SQL安全性验证通过
2025-03-08 18:09:15 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:09:15 - DEBUG - 字段验证完成
2025-03-08 18:09:15 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:09:46 - INFO - 开始构建查询引擎
2025-03-08 18:09:46 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:09:46 - INFO - 开始从头构建查询引擎
2025-03-08 18:09:48 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:09:48 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:09:48 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:09:48 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:09:48 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x00000279C762A0C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:09:48 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:09:48 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:09:48 - DEBUG - 表结构长度: 145328
2025-03-08 18:09:48 - INFO - 查询引擎构建完成，耗时: 1.96秒
2025-03-08 18:09:48 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:09:48 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:09:48 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:09:48 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:09:48 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:09:48 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:09:48 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:09:48 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:09:48 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:09:48 - DEBUG - 开始调用LLM...
2025-03-08 18:10:02 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:10:02 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:10:02 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:02 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:02 - DEBUG - SQL安全性验证通过
2025-03-08 18:10:02 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:10:02 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:02 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:02 - DEBUG - SQL安全性验证通过
2025-03-08 18:10:02 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:10:02 - DEBUG - 字段验证完成
2025-03-08 18:10:02 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:10:19 - INFO - 开始构建查询引擎
2025-03-08 18:10:19 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:10:19 - INFO - 开始从头构建查询引擎
2025-03-08 18:10:20 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:10:20 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:10:20 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:10:20 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:10:20 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x00000234DBF460C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:10:20 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:10:20 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:10:20 - DEBUG - 表结构长度: 145328
2025-03-08 18:10:20 - INFO - 查询引擎构建完成，耗时: 1.17秒
2025-03-08 18:10:20 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:10:20 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:10:20 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:10:20 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:10:20 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:10:20 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:10:20 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:10:20 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:10:20 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:10:20 - DEBUG - 开始调用LLM...
2025-03-08 18:10:31 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - 原始SQL长度: 433字符
2025-03-08 18:10:31 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:10:31 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:31 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:31 - DEBUG - SQL安全性验证通过
2025-03-08 18:10:31 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:10:31 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:31 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:10:31 - DEBUG - SQL安全性验证通过
2025-03-08 18:10:31 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 18:10:31 - DEBUG - 字段验证完成
2025-03-08 18:10:31 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701'", "result_size": 1294}
2025-03-08 18:11:21 - INFO - 开始构建查询引擎
2025-03-08 18:11:21 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:11:21 - INFO - 开始从头构建查询引擎
2025-03-08 18:11:23 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:11:23 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:11:23 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:11:23 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:11:23 - ERROR - 缓存保存失败: Can't pickle <function create_engine.<locals>.connect at 0x000001D14DEF60C0>: it's not found as sqlalchemy.engine.create.create_engine.<locals>.connect
2025-03-08 18:11:23 - DEBUG - 查询引擎初始化完成，已传入表结构和LLM
2025-03-08 18:11:23 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:11:23 - DEBUG - 表结构长度: 145328
2025-03-08 18:11:23 - INFO - 查询引擎构建完成，耗时: 1.88秒
2025-03-08 18:11:23 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:11:23 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:11:23 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:11:23 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:11:23 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:11:23 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:11:23 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:11:23 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:11:23 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:11:23 - DEBUG - 开始调用LLM...
2025-03-08 18:11:37 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:11:37 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:11:37 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:11:37 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:11:37 - DEBUG - SQL安全性验证通过
2025-03-08 18:11:37 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:11:37 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:11:37 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:11:37 - DEBUG - SQL安全性验证通过
2025-03-08 18:11:37 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:11:37 - DEBUG - 字段验证完成
2025-03-08 18:11:37 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:14:50 - INFO - 开始构建查询引擎
2025-03-08 18:14:52 - INFO - 未找到有效缓存，将重新构建查询引擎
2025-03-08 18:14:52 - INFO - 开始从头构建查询引擎
2025-03-08 18:14:52 - DEBUG - 加载的schema长度: 145328
2025-03-08 18:14:52 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:14:52 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:14:52 - INFO - 正在保存查询引擎缓存到: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:14:52 - INFO - 缓存保存成功，耗时: 0.04秒
2025-03-08 18:14:52 - DEBUG - LLM模型: DeepSeek
2025-03-08 18:14:52 - INFO - 查询引擎构建完成，耗时: 1.97秒
2025-03-08 18:14:52 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:14:52 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:14:52 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:14:52 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:14:52 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:14:52 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:14:52 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:14:52 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:14:52 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:14:52 - DEBUG - 开始调用LLM...
2025-03-08 18:15:05 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:05 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:15:05 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:15:05 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:05 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:05 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:05 - DEBUG - SQL安全性验证通过
2025-03-08 18:15:05 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:05 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:05 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:15:05 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:05 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:05 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:05 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:05 - DEBUG - SQL安全性验证通过
2025-03-08 18:15:06 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:06 - DEBUG - 字段验证完成
2025-03-08 18:15:06 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:15:21 - INFO - 开始构建查询引擎
2025-03-08 18:15:23 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:15:23 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:15:23 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:15:23 - INFO - 缓存年龄: 0.0小时
2025-03-08 18:15:23 - DEBUG - 缓存的表数量: 106
2025-03-08 18:15:23 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:15:23 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:15:23 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:15:23 - INFO - 查询引擎从缓存加载完成，耗时: 1.95秒
2025-03-08 18:15:23 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:15:23 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:15:23 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:15:23 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:15:23 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:15:23 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:15:23 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:15:23 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:15:23 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:15:23 - DEBUG - 开始调用LLM...
2025-03-08 18:15:41 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:41 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:15:41 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:15:41 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:41 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:41 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:41 - DEBUG - SQL安全性验证通过
2025-03-08 18:15:41 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:41 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:41 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:15:41 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:42 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:42 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:42 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:15:42 - DEBUG - SQL安全性验证通过
2025-03-08 18:15:42 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:15:42 - DEBUG - 字段验证完成
2025-03-08 18:15:42 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:16:04 - INFO - 开始构建查询引擎
2025-03-08 18:16:05 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:16:05 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:16:05 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:16:05 - INFO - 缓存年龄: 0.0小时
2025-03-08 18:16:05 - DEBUG - 缓存的表数量: 106
2025-03-08 18:16:05 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:16:05 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:16:05 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:16:05 - INFO - 查询引擎从缓存加载完成，耗时: 1.14秒
2025-03-08 18:16:05 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:16:05 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:16:05 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:16:05 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:16:05 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:16:05 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:16:05 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:16:05 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:16:05 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:16:05 - DEBUG - 开始调用LLM...
2025-03-08 18:16:20 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:16:20 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:16:20 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:16:20 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:16:20 - DEBUG - SQL安全性验证通过
2025-03-08 18:16:20 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:16:20 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:16:20 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:16:20 - DEBUG - SQL安全性验证通过
2025-03-08 18:16:20 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:16:20 - DEBUG - 字段验证完成
2025-03-08 18:16:20 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:20:47 - INFO - 开始构建查询引擎
2025-03-08 18:20:49 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:20:49 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:20:49 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:20:49 - INFO - 缓存年龄: 0.1小时
2025-03-08 18:20:49 - DEBUG - 缓存的表数量: 106
2025-03-08 18:20:49 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:20:49 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:20:49 - INFO - 重新计算表嵌入向量
2025-03-08 18:20:49 - INFO - 成功提取0个表的嵌入向量
2025-03-08 18:20:49 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 18:20:49 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:20:49 - INFO - 查询引擎从缓存加载完成，耗时: 2.57秒
2025-03-08 18:20:49 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:20:49 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:20:49 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:20:49 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:20:49 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:20:49 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:20:49 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:20:49 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:20:49 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:20:49 - DEBUG - 开始调用LLM...
2025-03-08 18:21:06 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:21:06 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:21:06 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:06 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:06 - DEBUG - SQL安全性验证通过
2025-03-08 18:21:06 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:21:06 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:06 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:06 - DEBUG - SQL安全性验证通过
2025-03-08 18:21:06 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:06 - DEBUG - 字段验证完成
2025-03-08 18:21:06 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:21:24 - INFO - 开始构建查询引擎
2025-03-08 18:21:25 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:21:25 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:21:25 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:21:25 - INFO - 缓存年龄: 0.1小时
2025-03-08 18:21:25 - DEBUG - 缓存的表数量: 106
2025-03-08 18:21:25 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:21:25 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:21:25 - INFO - 重新计算表嵌入向量
2025-03-08 18:21:25 - INFO - 成功提取0个表的嵌入向量
2025-03-08 18:21:25 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 18:21:25 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:21:25 - INFO - 查询引擎从缓存加载完成，耗时: 1.20秒
2025-03-08 18:21:25 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:21:25 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:21:25 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:21:25 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:21:25 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:21:25 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:21:25 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:21:25 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:21:25 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:21:25 - DEBUG - 开始调用LLM...
2025-03-08 18:21:47 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:21:47 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:21:47 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:47 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:47 - DEBUG - SQL安全性验证通过
2025-03-08 18:21:47 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:21:47 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:47 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:21:47 - DEBUG - SQL安全性验证通过
2025-03-08 18:21:47 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:21:47 - DEBUG - 字段验证完成
2025-03-08 18:21:47 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:22:03 - INFO - 开始构建查询引擎
2025-03-08 18:22:05 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:22:05 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:22:05 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:22:05 - INFO - 缓存年龄: 0.1小时
2025-03-08 18:22:05 - DEBUG - 缓存的表数量: 106
2025-03-08 18:22:05 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:22:05 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:22:05 - INFO - 重新计算表嵌入向量
2025-03-08 18:22:05 - INFO - 成功提取0个表的嵌入向量
2025-03-08 18:22:05 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 18:22:05 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:22:05 - INFO - 查询引擎从缓存加载完成，耗时: 1.91秒
2025-03-08 18:22:05 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:05 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:05 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:05 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:22:05 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:05 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:22:05 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:22:05 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:22:05 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:22:05 - DEBUG - 开始调用LLM...
2025-03-08 18:22:30 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:22:30 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:22:30 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:22:30 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:22:30 - DEBUG - SQL安全性验证通过
2025-03-08 18:22:30 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:22:30 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:22:30 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:22:30 - DEBUG - SQL安全性验证通过
2025-03-08 18:22:30 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:22:30 - DEBUG - 字段验证完成
2025-03-08 18:22:30 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:22:52 - INFO - 开始构建查询引擎
2025-03-08 18:22:53 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:22:53 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:22:53 - INFO - 缓存加载成功，耗时: 0.03秒
2025-03-08 18:22:53 - INFO - 缓存年龄: 0.1小时
2025-03-08 18:22:53 - DEBUG - 缓存的表数量: 106
2025-03-08 18:22:53 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:22:53 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:22:53 - INFO - 重新计算表嵌入向量
2025-03-08 18:22:53 - INFO - 成功提取0个表的嵌入向量
2025-03-08 18:22:53 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 18:22:53 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:22:53 - INFO - 查询引擎从缓存加载完成，耗时: 1.26秒
2025-03-08 18:22:53 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:53 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:53 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:53 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:22:53 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:22:53 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:22:53 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:22:53 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:22:53 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:22:53 - DEBUG - 开始调用LLM...
2025-03-08 18:23:07 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:23:07 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:23:07 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:07 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:07 - DEBUG - SQL安全性验证通过
2025-03-08 18:23:07 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:23:07 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:07 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:07 - DEBUG - SQL安全性验证通过
2025-03-08 18:23:07 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:07 - DEBUG - 字段验证完成
2025-03-08 18:23:07 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:23:33 - INFO - 开始构建查询引擎
2025-03-08 18:23:35 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:23:35 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:23:35 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:23:35 - INFO - 缓存年龄: 0.1小时
2025-03-08 18:23:35 - DEBUG - 缓存的表数量: 106
2025-03-08 18:23:35 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:23:35 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:23:35 - INFO - 重新计算表嵌入向量
2025-03-08 18:23:35 - INFO - 成功提取0个表的嵌入向量
2025-03-08 18:23:35 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 18:23:35 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:23:35 - INFO - 查询引擎从缓存加载完成，耗时: 1.88秒
2025-03-08 18:23:35 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:23:35 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:23:35 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:23:35 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:23:35 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:23:35 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:23:35 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:23:35 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:23:35 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:23:35 - DEBUG - 开始调用LLM...
2025-03-08 18:23:51 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:23:51 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:23:51 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:51 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:51 - DEBUG - SQL安全性验证通过
2025-03-08 18:23:51 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:23:51 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:51 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:23:51 - DEBUG - SQL安全性验证通过
2025-03-08 18:23:51 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:23:51 - DEBUG - 字段验证完成
2025-03-08 18:23:51 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 18:24:10 - INFO - 开始构建查询引擎
2025-03-08 18:24:12 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:24:12 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 18:24:12 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 18:24:12 - INFO - 缓存年龄: 0.2小时
2025-03-08 18:24:12 - DEBUG - 缓存的表数量: 106
2025-03-08 18:24:12 - DEBUG - 缓存的schema长度: 145328
2025-03-08 18:24:12 - DEBUG - 创建的表schema数量: 106
2025-03-08 18:24:12 - INFO - 重新计算表嵌入向量
2025-03-08 18:24:12 - INFO - 成功提取0个表的嵌入向量
2025-03-08 18:24:12 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 18:24:12 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 18:24:12 - INFO - 查询引擎从缓存加载完成，耗时: 2.17秒
2025-03-08 18:24:12 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:24:12 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:24:12 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:24:12 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 18:24:12 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 18:24:12 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 18:24:12 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 18:24:12 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 18:24:12 - DEBUG - 提示总长度: 1439字符
2025-03-08 18:24:12 - DEBUG - 开始调用LLM...
2025-03-08 18:24:23 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - 原始SQL长度: 434字符
2025-03-08 18:24:23 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 18:24:23 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:24:23 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:24:23 - DEBUG - SQL安全性验证通过
2025-03-08 18:24:23 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 18:24:23 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:24:23 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 18:24:23 - DEBUG - SQL安全性验证通过
2025-03-08 18:24:23 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 18:24:23 - DEBUG - 字段验证完成
2025-03-08 18:24:23 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 21:10:20 - INFO - 开始构建查询引擎
2025-03-08 21:10:22 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:10:22 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:10:22 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 21:10:22 - INFO - 缓存年龄: 2.9小时
2025-03-08 21:10:22 - DEBUG - 缓存的表数量: 106
2025-03-08 21:10:22 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:10:22 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:10:22 - INFO - 重新计算表嵌入向量
2025-03-08 21:10:22 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:10:22 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 21:10:22 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:10:22 - INFO - 查询引擎从缓存加载完成，耗时: 2.00秒
2025-03-08 21:10:22 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:10:22 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:10:22 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:10:22 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:10:22 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:10:22 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:10:22 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:10:22 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:10:22 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:10:22 - DEBUG - 开始调用LLM...
2025-03-08 21:10:37 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - 原始SQL长度: 434字符
2025-03-08 21:10:37 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:10:37 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:10:37 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:10:37 - DEBUG - SQL安全性验证通过
2025-03-08 21:10:37 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:10:37 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:10:37 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:10:37 - DEBUG - SQL安全性验证通过
2025-03-08 21:10:37 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:10:37 - DEBUG - 字段验证完成
2025-03-08 21:10:37 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 21:12:42 - INFO - 开始构建查询引擎
2025-03-08 21:12:44 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:12:44 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:12:44 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 21:12:44 - INFO - 缓存年龄: 3.0小时
2025-03-08 21:12:44 - DEBUG - 缓存的表数量: 106
2025-03-08 21:12:44 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:12:44 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:12:44 - INFO - 重新计算表嵌入向量
2025-03-08 21:12:44 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:12:44 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 21:12:44 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:12:44 - INFO - 查询引擎从缓存加载完成，耗时: 1.95秒
2025-03-08 21:12:44 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:12:44 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:12:44 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:12:44 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:12:44 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:12:44 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:12:44 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:12:44 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:12:44 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:12:44 - DEBUG - 开始调用LLM...
2025-03-08 21:12:56 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - 原始SQL长度: 433字符
2025-03-08 21:12:56 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:12:56 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:12:56 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:12:56 - DEBUG - SQL安全性验证通过
2025-03-08 21:12:56 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:12:56 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:12:56 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:12:56 - DEBUG - SQL安全性验证通过
2025-03-08 21:12:56 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:12:56 - DEBUG - 字段验证完成
2025-03-08 21:12:56 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701'", "result_size": 1294}
2025-03-08 21:14:47 - INFO - 开始构建查询引擎
2025-03-08 21:14:49 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:14:49 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:14:49 - INFO - 缓存加载成功，耗时: 0.02秒
2025-03-08 21:14:49 - INFO - 缓存年龄: 3.0小时
2025-03-08 21:14:49 - DEBUG - 缓存的表数量: 106
2025-03-08 21:14:49 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:14:49 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:14:49 - INFO - 重新计算表嵌入向量
2025-03-08 21:14:49 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:14:49 - INFO - 表嵌入向量计算耗时: 0.00秒
2025-03-08 21:14:49 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:14:49 - INFO - 查询引擎从缓存加载完成，耗时: 1.88秒
2025-03-08 21:14:49 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:14:49 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:14:49 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:14:49 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:14:49 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:14:49 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:14:49 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:14:49 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:14:49 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:14:49 - DEBUG - 开始调用LLM...
2025-03-08 21:15:04 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - 原始SQL长度: 433字符
2025-03-08 21:15:04 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:15:04 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:15:04 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:15:04 - DEBUG - SQL安全性验证通过
2025-03-08 21:15:04 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:15:04 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:15:04 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:15:04 - DEBUG - SQL安全性验证通过
2025-03-08 21:15:04 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:15:04 - DEBUG - 字段验证完成
2025-03-08 21:15:04 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701'", "result_size": 1294}
2025-03-08 21:18:53 - INFO - 开始构建查询引擎
2025-03-08 21:18:55 - INFO - [性能] 创建SQLDatabase耗时: 1.88秒
2025-03-08 21:18:55 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:18:55 - INFO - [性能] 检查缓存耗时: 0.00秒
2025-03-08 21:18:55 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:18:55 - INFO - [性能] 读取缓存文件耗时: 0.02秒
2025-03-08 21:18:55 - INFO - 缓存年龄: 3.1小时
2025-03-08 21:18:55 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:18:55 - INFO - 缓存加载成功，总耗时: 0.03秒
2025-03-08 21:18:55 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:18:55 - INFO - 读取缓存文件: 0.02秒
2025-03-08 21:18:55 - INFO - 验证缓存: 0.00秒
2025-03-08 21:18:55 - INFO - 总耗时: 0.03秒
2025-03-08 21:18:55 - INFO - =========================
2025-03-08 21:18:55 - INFO - [性能] 加载缓存耗时: 0.03秒
2025-03-08 21:18:55 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:18:55 - DEBUG - 缓存的表数量: 106
2025-03-08 21:18:55 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:18:55 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:18:55 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:18:55 - INFO - 重新计算表嵌入向量
2025-03-08 21:18:55 - INFO - 正在加载嵌入模型...
2025-03-08 21:18:55 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:18:55 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:18:55 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:18:55 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:18:55 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:18:55 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:18:55 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:18:55 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:18:55 - INFO - 创建表schema: 0.00秒
2025-03-08 21:18:55 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:18:55 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:18:55 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:18:55 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:18:55 - INFO - 总耗时: 0.00秒
2025-03-08 21:18:55 - INFO - ============================
2025-03-08 21:18:55 - INFO - [性能] 创建查询引擎耗时: 0.00秒
2025-03-08 21:18:55 - INFO - 查询引擎从缓存加载完成，总耗时: 1.91秒
2025-03-08 21:18:55 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:18:55 - INFO - 创建SQLDatabase: 1.88秒
2025-03-08 21:18:55 - INFO - 检查缓存: 0.00秒
2025-03-08 21:18:55 - INFO - 加载缓存: 0.03秒
2025-03-08 21:18:55 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:18:55 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:18:55 - INFO - 总耗时: 1.91秒
2025-03-08 21:18:55 - INFO - ========================
2025-03-08 21:18:55 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:18:55 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:18:55 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:18:55 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:18:55 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:18:55 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:18:55 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:18:55 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:18:55 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:18:55 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:18:55 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:18:55 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:18:55 - DEBUG - 开始调用LLM...
2025-03-08 21:19:07 - INFO - [性能] LLM调用耗时: 12.49秒
2025-03-08 21:19:07 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - 原始SQL长度: 434字符
2025-03-08 21:19:07 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:19:07 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:19:07 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:19:07 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:19:07 - DEBUG - SQL安全性验证通过
2025-03-08 21:19:07 - INFO - [性能] SQL验证耗时: 0.00秒
2025-03-08 21:19:07 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:19:07 - INFO - [性能] SQL执行耗时: 0.02秒
2025-03-08 21:19:07 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:19:07 - INFO - 选择相关表: 0.00秒
2025-03-08 21:19:07 - INFO - 构建schema: 0.00秒
2025-03-08 21:19:07 - INFO - 构建提示: 0.00秒
2025-03-08 21:19:07 - INFO - LLM调用: 12.49秒
2025-03-08 21:19:07 - INFO - SQL验证: 0.00秒
2025-03-08 21:19:07 - INFO - SQL执行: 0.02秒
2025-03-08 21:19:07 - INFO - 总耗时: 12.51秒
2025-03-08 21:19:07 - INFO - ===============================
2025-03-08 21:19:07 - INFO - [性能] LLM生成SQL耗时: 12.51秒
2025-03-08 21:19:07 - INFO - [性能] 查询总耗时: 12.51秒
2025-03-08 21:19:07 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:19:07 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:19:07 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:19:07 - DEBUG - SQL安全性验证通过
2025-03-08 21:19:07 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:19:07 - DEBUG - 字段验证完成
2025-03-08 21:19:07 - INFO - [性能] SQL验证耗时: 0.03秒
2025-03-08 21:19:07 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 21:19:07 - INFO - [性能] 查询处理总耗时: 12.54秒
2025-03-08 21:19:07 - INFO - ===== 查询性能明细 =====
2025-03-08 21:19:07 - INFO - LLM生成SQL: 12.51秒
2025-03-08 21:19:07 - INFO - SQL验证: 0.03秒
2025-03-08 21:19:07 - INFO - 总耗时: 12.54秒
2025-03-08 21:19:07 - INFO - =======================
2025-03-08 21:20:41 - INFO - 开始构建查询引擎
2025-03-08 21:20:43 - INFO - [性能] 创建SQLDatabase耗时: 1.80秒
2025-03-08 21:20:43 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:20:43 - INFO - [性能] 检查缓存耗时: 0.00秒
2025-03-08 21:20:43 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:20:43 - INFO - [性能] 读取缓存文件耗时: 0.02秒
2025-03-08 21:20:43 - INFO - 缓存年龄: 3.1小时
2025-03-08 21:20:43 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:20:43 - INFO - 缓存加载成功，总耗时: 0.02秒
2025-03-08 21:20:43 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:20:43 - INFO - 读取缓存文件: 0.02秒
2025-03-08 21:20:43 - INFO - 验证缓存: 0.00秒
2025-03-08 21:20:43 - INFO - 总耗时: 0.02秒
2025-03-08 21:20:43 - INFO - =========================
2025-03-08 21:20:43 - INFO - [性能] 加载缓存耗时: 0.02秒
2025-03-08 21:20:43 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:20:43 - DEBUG - 缓存的表数量: 106
2025-03-08 21:20:43 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:20:43 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:20:43 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:20:43 - INFO - 重新计算表嵌入向量
2025-03-08 21:20:43 - INFO - 正在加载嵌入模型...
2025-03-08 21:20:43 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:20:43 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:20:43 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:20:43 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:20:43 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:20:43 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:20:43 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:20:43 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:20:43 - INFO - 创建表schema: 0.00秒
2025-03-08 21:20:43 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:20:43 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:20:43 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:20:43 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:20:43 - INFO - 总耗时: 0.00秒
2025-03-08 21:20:43 - INFO - ============================
2025-03-08 21:20:43 - INFO - [性能] 创建查询引擎耗时: 0.00秒
2025-03-08 21:20:43 - INFO - 查询引擎从缓存加载完成，总耗时: 1.83秒
2025-03-08 21:20:43 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:20:43 - INFO - 创建SQLDatabase: 1.80秒
2025-03-08 21:20:43 - INFO - 检查缓存: 0.00秒
2025-03-08 21:20:43 - INFO - 加载缓存: 0.02秒
2025-03-08 21:20:43 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:20:43 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:20:43 - INFO - 总耗时: 1.83秒
2025-03-08 21:20:43 - INFO - ========================
2025-03-08 21:20:43 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:20:43 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:20:43 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:20:43 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:20:43 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:20:43 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:20:43 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:20:43 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:20:43 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:20:43 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:20:43 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:20:43 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:20:43 - DEBUG - 开始调用LLM...
2025-03-08 21:20:56 - INFO - [性能] LLM调用耗时: 13.35秒
2025-03-08 21:20:56 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - 原始SQL长度: 434字符
2025-03-08 21:20:56 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:20:56 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:20:56 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:20:56 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:20:56 - DEBUG - SQL安全性验证通过
2025-03-08 21:20:56 - INFO - [性能] SQL验证耗时: 0.00秒
2025-03-08 21:20:56 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:20:56 - INFO - [性能] SQL执行耗时: 0.01秒
2025-03-08 21:20:56 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:20:56 - INFO - 选择相关表: 0.00秒
2025-03-08 21:20:56 - INFO - 构建schema: 0.00秒
2025-03-08 21:20:56 - INFO - 构建提示: 0.00秒
2025-03-08 21:20:56 - INFO - LLM调用: 13.35秒
2025-03-08 21:20:56 - INFO - SQL验证: 0.00秒
2025-03-08 21:20:56 - INFO - SQL执行: 0.01秒
2025-03-08 21:20:56 - INFO - 总耗时: 13.36秒
2025-03-08 21:20:56 - INFO - ===============================
2025-03-08 21:20:56 - INFO - [性能] LLM生成SQL耗时: 13.36秒
2025-03-08 21:20:56 - INFO - [性能] 查询总耗时: 13.36秒
2025-03-08 21:20:56 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:20:56 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:20:56 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:20:56 - DEBUG - SQL安全性验证通过
2025-03-08 21:20:56 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:20:56 - DEBUG - 字段验证完成
2025-03-08 21:20:56 - INFO - [性能] SQL验证耗时: 0.03秒
2025-03-08 21:20:56 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 21:20:56 - INFO - [性能] 查询处理总耗时: 13.39秒
2025-03-08 21:20:56 - INFO - ===== 查询性能明细 =====
2025-03-08 21:20:56 - INFO - LLM生成SQL: 13.36秒
2025-03-08 21:20:56 - INFO - SQL验证: 0.03秒
2025-03-08 21:20:56 - INFO - 总耗时: 13.39秒
2025-03-08 21:20:56 - INFO - =======================
2025-03-08 21:40:48 - INFO - 正在预先初始化数据库连接池配置...
2025-03-08 21:40:48 - INFO - [性能] 创建数据库连接池耗时: 0.00秒
2025-03-08 21:40:48 - INFO - 数据库连接池初始化完成: 大小=5, 最大溢出=10
2025-03-08 21:40:48 - INFO - 开始构建查询引擎
2025-03-08 21:44:47 - INFO - 正在预先初始化数据库连接池配置...
2025-03-08 21:44:47 - INFO - [性能] 创建数据库连接池耗时: 0.00秒
2025-03-08 21:44:47 - INFO - 数据库连接池初始化完成: 大小=5, 最大溢出=10
2025-03-08 21:44:47 - INFO - 开始构建查询引擎
2025-03-08 21:44:49 - INFO - [性能] 创建SQLDatabase耗时: 1.88秒
2025-03-08 21:44:49 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:44:49 - INFO - [性能] 检查缓存耗时: 0.00秒
2025-03-08 21:44:49 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:44:49 - INFO - [性能] 读取缓存文件耗时: 0.02秒
2025-03-08 21:44:49 - INFO - 缓存年龄: 3.5小时
2025-03-08 21:44:49 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:44:49 - INFO - 缓存加载成功，总耗时: 0.02秒
2025-03-08 21:44:49 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:44:49 - INFO - 读取缓存文件: 0.02秒
2025-03-08 21:44:49 - INFO - 验证缓存: 0.00秒
2025-03-08 21:44:49 - INFO - 总耗时: 0.02秒
2025-03-08 21:44:49 - INFO - =========================
2025-03-08 21:44:49 - INFO - [性能] 加载缓存耗时: 0.03秒
2025-03-08 21:44:49 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:44:49 - DEBUG - 缓存的表数量: 106
2025-03-08 21:44:49 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:44:49 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:44:49 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:44:49 - INFO - 重新计算表嵌入向量
2025-03-08 21:44:49 - INFO - 正在加载嵌入模型...
2025-03-08 21:44:49 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:44:49 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:44:49 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:44:49 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:44:49 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:44:49 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:44:49 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:44:49 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:44:49 - INFO - 创建表schema: 0.00秒
2025-03-08 21:44:49 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:44:49 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:44:49 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:44:49 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:44:49 - INFO - 总耗时: 0.00秒
2025-03-08 21:44:49 - INFO - ============================
2025-03-08 21:44:49 - INFO - [性能] 创建查询引擎耗时: 0.01秒
2025-03-08 21:44:49 - INFO - 查询引擎从缓存加载完成，总耗时: 1.91秒
2025-03-08 21:44:49 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:44:49 - INFO - 创建SQLDatabase: 1.88秒
2025-03-08 21:44:49 - INFO - 检查缓存: 0.00秒
2025-03-08 21:44:49 - INFO - 加载缓存: 0.03秒
2025-03-08 21:44:49 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:44:49 - INFO - 创建查询引擎: 0.01秒
2025-03-08 21:44:49 - INFO - 总耗时: 1.91秒
2025-03-08 21:44:49 - INFO - ========================
2025-03-08 21:44:49 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:44:49 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:44:49 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:44:49 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:44:49 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:44:49 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:44:49 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:44:49 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:44:49 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:44:49 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:44:49 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:44:49 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:44:49 - DEBUG - 开始调用LLM...
2025-03-08 21:45:07 - INFO - [性能] LLM调用耗时: 18.38秒
2025-03-08 21:45:07 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:45:07 - DEBUG - 原始SQL长度: 434字符
2025-03-08 21:45:07 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:45:07 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:45:07 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:45:07 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:45:07 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:45:07 - DEBUG - SQL安全性验证通过
2025-03-08 21:45:07 - INFO - [性能] SQL验证耗时: 0.00秒
2025-03-08 21:45:07 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:45:07 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:45:07 - ERROR - 执行SQL失败: 'str' object has no attribute 'get'
2025-03-08 21:45:07 - INFO - [性能] SQL执行失败，耗时: 0.00秒
2025-03-08 21:45:07 - ERROR - {"type": "query", "status": "error", "query": "查询产品编号为TC2024112701的送货明细", "error": "SQL执行失败: 'str' object has no attribute 'get'", "sql": ""}
2025-03-08 21:45:07 - INFO - [性能] 查询失败，总耗时: 18.40秒
2025-03-08 21:47:01 - INFO - 正在预先初始化数据库连接池配置...
2025-03-08 21:47:01 - INFO - [性能] 创建数据库连接池耗时: 0.00秒
2025-03-08 21:47:01 - INFO - 数据库连接池初始化完成: 大小=5, 最大溢出=10
2025-03-08 21:47:01 - INFO - 开始构建查询引擎
2025-03-08 21:47:03 - INFO - [性能] 创建SQLDatabase耗时: 1.87秒
2025-03-08 21:47:03 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:47:03 - INFO - [性能] 检查缓存耗时: 0.00秒
2025-03-08 21:47:03 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:47:03 - INFO - [性能] 读取缓存文件耗时: 0.02秒
2025-03-08 21:47:03 - INFO - 缓存年龄: 3.5小时
2025-03-08 21:47:03 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:47:03 - INFO - 缓存加载成功，总耗时: 0.02秒
2025-03-08 21:47:03 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:47:03 - INFO - 读取缓存文件: 0.02秒
2025-03-08 21:47:03 - INFO - 验证缓存: 0.00秒
2025-03-08 21:47:03 - INFO - 总耗时: 0.02秒
2025-03-08 21:47:03 - INFO - =========================
2025-03-08 21:47:03 - INFO - [性能] 加载缓存耗时: 0.03秒
2025-03-08 21:47:03 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:47:03 - DEBUG - 缓存的表数量: 106
2025-03-08 21:47:03 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:47:03 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:47:03 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:47:03 - INFO - 重新计算表嵌入向量
2025-03-08 21:47:03 - INFO - 正在加载嵌入模型...
2025-03-08 21:47:03 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:47:03 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:47:03 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:47:03 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:47:03 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:47:03 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:47:03 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:47:03 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:47:03 - INFO - 创建表schema: 0.00秒
2025-03-08 21:47:03 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:47:03 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:47:03 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:47:03 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:47:03 - INFO - 总耗时: 0.00秒
2025-03-08 21:47:03 - INFO - ============================
2025-03-08 21:47:03 - INFO - [性能] 创建查询引擎耗时: 0.01秒
2025-03-08 21:47:03 - INFO - 查询引擎从缓存加载完成，总耗时: 1.91秒
2025-03-08 21:47:03 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:47:03 - INFO - 创建SQLDatabase: 1.87秒
2025-03-08 21:47:03 - INFO - 检查缓存: 0.00秒
2025-03-08 21:47:03 - INFO - 加载缓存: 0.03秒
2025-03-08 21:47:03 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:47:03 - INFO - 创建查询引擎: 0.01秒
2025-03-08 21:47:03 - INFO - 总耗时: 1.91秒
2025-03-08 21:47:03 - INFO - ========================
2025-03-08 21:47:03 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:03 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:03 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:03 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:47:03 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:03 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:47:03 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:47:03 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:47:03 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:47:03 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:47:03 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:47:03 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:47:03 - DEBUG - 开始调用LLM...
2025-03-08 21:47:16 - INFO - [性能] LLM调用耗时: 12.34秒
2025-03-08 21:47:16 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 原始SQL长度: 433字符
2025-03-08 21:47:16 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:47:16 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:16 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:16 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:47:16 - DEBUG - SQL安全性验证通过
2025-03-08 21:47:16 - INFO - [性能] SQL验证耗时: 0.00秒
2025-03-08 21:47:16 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 获取连接池状态出错: 'str' object has no attribute 'get'
2025-03-08 21:47:16 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:47:16 - INFO - [性能] SQL执行耗时: 0.01秒
2025-03-08 21:47:16 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:47:16 - INFO - 选择相关表: 0.00秒
2025-03-08 21:47:16 - INFO - 构建schema: 0.00秒
2025-03-08 21:47:16 - INFO - 构建提示: 0.00秒
2025-03-08 21:47:16 - INFO - LLM调用: 12.34秒
2025-03-08 21:47:16 - INFO - SQL验证: 0.00秒
2025-03-08 21:47:16 - INFO - SQL执行: 0.01秒
2025-03-08 21:47:16 - INFO - 总耗时: 12.36秒
2025-03-08 21:47:16 - INFO - ===============================
2025-03-08 21:47:16 - INFO - [性能] LLM生成SQL耗时: 12.37秒
2025-03-08 21:47:16 - INFO - [性能] 查询总耗时: 12.37秒
2025-03-08 21:47:16 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:16 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:16 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:47:16 - DEBUG - SQL安全性验证通过
2025-03-08 21:47:16 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:16 - DEBUG - 字段验证完成
2025-03-08 21:47:16 - INFO - [性能] SQL验证耗时: 0.02秒
2025-03-08 21:47:16 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701'", "result_size": 1294}
2025-03-08 21:47:16 - INFO - [性能] 查询处理总耗时: 12.39秒
2025-03-08 21:47:16 - INFO - ===== 查询性能明细 =====
2025-03-08 21:47:16 - INFO - LLM生成SQL: 12.37秒
2025-03-08 21:47:16 - INFO - SQL验证: 0.02秒
2025-03-08 21:47:16 - INFO - 总耗时: 12.39秒
2025-03-08 21:47:16 - INFO - =======================
2025-03-08 21:47:36 - INFO - 正在预先初始化数据库连接池配置...
2025-03-08 21:47:36 - INFO - [性能] 创建数据库连接池耗时: 0.00秒
2025-03-08 21:47:36 - INFO - 数据库连接池初始化完成: 大小=5, 最大溢出=10
2025-03-08 21:47:36 - INFO - 开始构建查询引擎
2025-03-08 21:47:38 - INFO - [性能] 创建SQLDatabase耗时: 2.46秒
2025-03-08 21:47:38 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:47:38 - INFO - [性能] 检查缓存耗时: 0.00秒
2025-03-08 21:47:38 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:47:38 - INFO - [性能] 读取缓存文件耗时: 0.02秒
2025-03-08 21:47:38 - INFO - 缓存年龄: 3.5小时
2025-03-08 21:47:38 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:47:38 - INFO - 缓存加载成功，总耗时: 0.03秒
2025-03-08 21:47:38 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:47:38 - INFO - 读取缓存文件: 0.02秒
2025-03-08 21:47:38 - INFO - 验证缓存: 0.00秒
2025-03-08 21:47:38 - INFO - 总耗时: 0.03秒
2025-03-08 21:47:38 - INFO - =========================
2025-03-08 21:47:38 - INFO - [性能] 加载缓存耗时: 0.03秒
2025-03-08 21:47:38 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:47:38 - DEBUG - 缓存的表数量: 106
2025-03-08 21:47:38 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:47:38 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:47:38 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:47:38 - INFO - 重新计算表嵌入向量
2025-03-08 21:47:38 - INFO - 正在加载嵌入模型...
2025-03-08 21:47:38 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:47:38 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:47:38 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:47:38 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:47:38 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:47:38 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:47:38 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:47:38 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:47:38 - INFO - 创建表schema: 0.00秒
2025-03-08 21:47:38 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:47:38 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:47:38 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:47:38 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:47:38 - INFO - 总耗时: 0.00秒
2025-03-08 21:47:38 - INFO - ============================
2025-03-08 21:47:38 - INFO - [性能] 创建查询引擎耗时: 0.01秒
2025-03-08 21:47:38 - INFO - 查询引擎从缓存加载完成，总耗时: 2.50秒
2025-03-08 21:47:38 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:47:38 - INFO - 创建SQLDatabase: 2.46秒
2025-03-08 21:47:38 - INFO - 检查缓存: 0.00秒
2025-03-08 21:47:38 - INFO - 加载缓存: 0.03秒
2025-03-08 21:47:38 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:47:38 - INFO - 创建查询引擎: 0.01秒
2025-03-08 21:47:38 - INFO - 总耗时: 2.50秒
2025-03-08 21:47:38 - INFO - ========================
2025-03-08 21:47:38 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:38 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:38 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:38 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:47:38 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:47:38 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:47:38 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:47:38 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:47:38 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:47:38 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:47:38 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:47:38 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:47:38 - DEBUG - 开始调用LLM...
2025-03-08 21:47:53 - INFO - [性能] LLM调用耗时: 15.26秒
2025-03-08 21:47:53 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 原始SQL长度: 433字符
2025-03-08 21:47:53 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:47:53 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:53 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:53 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:47:53 - DEBUG - SQL安全性验证通过
2025-03-08 21:47:53 - INFO - [性能] SQL验证耗时: 0.00秒
2025-03-08 21:47:53 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 获取连接池状态出错: 'str' object has no attribute 'get'
2025-03-08 21:47:53 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:47:53 - INFO - [性能] SQL执行耗时: 0.01秒
2025-03-08 21:47:53 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:47:53 - INFO - 选择相关表: 0.00秒
2025-03-08 21:47:53 - INFO - 构建schema: 0.00秒
2025-03-08 21:47:53 - INFO - 构建提示: 0.00秒
2025-03-08 21:47:53 - INFO - LLM调用: 15.26秒
2025-03-08 21:47:53 - INFO - SQL验证: 0.00秒
2025-03-08 21:47:53 - INFO - SQL执行: 0.01秒
2025-03-08 21:47:53 - INFO - 总耗时: 15.27秒
2025-03-08 21:47:53 - INFO - ===============================
2025-03-08 21:47:53 - INFO - [性能] LLM生成SQL耗时: 15.27秒
2025-03-08 21:47:53 - INFO - [性能] 查询总耗时: 15.27秒
2025-03-08 21:47:53 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:53 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:47:53 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:47:53 - DEBUG - SQL安全性验证通过
2025-03-08 21:47:53 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:47:53 - DEBUG - 字段验证完成
2025-03-08 21:47:53 - INFO - [性能] SQL验证耗时: 0.02秒
2025-03-08 21:47:53 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701'", "result_size": 1294}
2025-03-08 21:47:53 - INFO - [性能] 查询处理总耗时: 15.30秒
2025-03-08 21:47:53 - INFO - ===== 查询性能明细 =====
2025-03-08 21:47:53 - INFO - LLM生成SQL: 15.27秒
2025-03-08 21:47:53 - INFO - SQL验证: 0.02秒
2025-03-08 21:47:53 - INFO - 总耗时: 15.30秒
2025-03-08 21:47:53 - INFO - =======================
2025-03-08 21:52:07 - INFO - 正在预先初始化数据库连接池配置...
2025-03-08 21:52:07 - INFO - [性能] 创建数据库连接池耗时: 0.00秒
2025-03-08 21:52:07 - INFO - 数据库连接池初始化完成: 大小=5, 最大溢出=10
2025-03-08 21:52:07 - INFO - 开始构建查询引擎
2025-03-08 21:52:09 - INFO - [性能] 创建SQLDatabase耗时: 1.88秒
2025-03-08 21:52:09 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:52:09 - INFO - [性能] 检查缓存耗时: 0.01秒
2025-03-08 21:52:09 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:52:09 - INFO - [性能] 读取缓存文件耗时: 0.02秒
2025-03-08 21:52:09 - INFO - 缓存年龄: 3.6小时
2025-03-08 21:52:09 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:52:09 - INFO - 缓存加载成功，总耗时: 0.02秒
2025-03-08 21:52:09 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:52:09 - INFO - 读取缓存文件: 0.02秒
2025-03-08 21:52:09 - INFO - 验证缓存: 0.00秒
2025-03-08 21:52:09 - INFO - 总耗时: 0.02秒
2025-03-08 21:52:09 - INFO - =========================
2025-03-08 21:52:09 - INFO - [性能] 加载缓存耗时: 0.03秒
2025-03-08 21:52:09 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:52:09 - DEBUG - 缓存的表数量: 106
2025-03-08 21:52:09 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:52:09 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:52:09 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:52:09 - INFO - 重新计算表嵌入向量
2025-03-08 21:52:09 - INFO - 正在加载嵌入模型...
2025-03-08 21:52:09 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:52:09 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:52:09 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:52:09 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:52:09 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:52:09 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:52:09 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:52:09 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:52:09 - INFO - 创建表schema: 0.00秒
2025-03-08 21:52:09 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:52:09 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:52:09 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:52:09 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:52:09 - INFO - 总耗时: 0.00秒
2025-03-08 21:52:09 - INFO - ============================
2025-03-08 21:52:09 - INFO - [性能] 创建查询引擎耗时: 0.00秒
2025-03-08 21:52:09 - INFO - 查询引擎从缓存加载完成，总耗时: 1.91秒
2025-03-08 21:52:09 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:52:09 - INFO - 创建SQLDatabase: 1.88秒
2025-03-08 21:52:09 - INFO - 检查缓存: 0.01秒
2025-03-08 21:52:09 - INFO - 加载缓存: 0.03秒
2025-03-08 21:52:09 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:52:09 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:52:09 - INFO - 总耗时: 1.91秒
2025-03-08 21:52:09 - INFO - ========================
2025-03-08 21:52:09 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:52:09 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:52:09 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:52:09 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:52:09 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:52:09 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:52:09 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:52:09 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:52:09 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:52:09 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:52:09 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:52:09 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:52:09 - DEBUG - 开始调用LLM...
2025-03-08 21:52:22 - INFO - [性能] LLM调用耗时: 13.29秒
2025-03-08 21:52:22 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 原始SQL长度: 434字符
2025-03-08 21:52:22 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:52:22 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:52:22 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:52:22 - DEBUG - [性能] SQL验证总耗时: 0.01秒 (清理: 0.00秒, 验证: 0.01秒)
2025-03-08 21:52:22 - DEBUG - SQL安全性验证通过
2025-03-08 21:52:22 - INFO - [性能] SQL验证耗时: 0.01秒
2025-03-08 21:52:22 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 获取连接池状态出错: 'str' object has no attribute 'get'
2025-03-08 21:52:22 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:52:22 - INFO - [性能] SQL执行耗时: 0.01秒
2025-03-08 21:52:22 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:52:22 - INFO - 选择相关表: 0.00秒
2025-03-08 21:52:22 - INFO - 构建schema: 0.00秒
2025-03-08 21:52:22 - INFO - 构建提示: 0.00秒
2025-03-08 21:52:22 - INFO - LLM调用: 13.29秒
2025-03-08 21:52:22 - INFO - SQL验证: 0.01秒
2025-03-08 21:52:22 - INFO - SQL执行: 0.01秒
2025-03-08 21:52:22 - INFO - 总耗时: 13.31秒
2025-03-08 21:52:22 - INFO - ===============================
2025-03-08 21:52:22 - INFO - [性能] LLM生成SQL耗时: 13.31秒
2025-03-08 21:52:22 - INFO - [性能] 查询总耗时: 13.31秒
2025-03-08 21:52:22 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:52:22 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:52:22 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:52:22 - DEBUG - SQL安全性验证通过
2025-03-08 21:52:22 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:52:22 - DEBUG - 字段验证完成
2025-03-08 21:52:22 - INFO - [性能] SQL验证耗时: 0.02秒
2025-03-08 21:52:22 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 21:52:22 - INFO - [性能] 查询处理总耗时: 13.33秒
2025-03-08 21:52:22 - INFO - ===== 查询性能明细 =====
2025-03-08 21:52:22 - INFO - LLM生成SQL: 13.31秒
2025-03-08 21:52:22 - INFO - SQL验证: 0.02秒
2025-03-08 21:52:22 - INFO - 总耗时: 13.33秒
2025-03-08 21:52:22 - INFO - =======================
2025-03-08 21:53:32 - INFO - 正在预先初始化数据库连接池配置...
2025-03-08 21:53:32 - INFO - [性能] 创建数据库连接池耗时: 0.00秒
2025-03-08 21:53:32 - INFO - 数据库连接池初始化完成: 大小=5, 最大溢出=10
2025-03-08 21:53:32 - INFO - 开始构建查询引擎
2025-03-08 21:53:34 - INFO - [性能] 创建SQLDatabase耗时: 1.81秒
2025-03-08 21:53:34 - INFO - 找到有效缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:53:34 - INFO - [性能] 检查缓存耗时: 0.00秒
2025-03-08 21:53:34 - INFO - 正在加载查询引擎缓存: cache\engine_cache_v1.0_aeabae014a94212caf74003d04bc6f6cfb0febb92796d712e7fa078f0757423e.joblib
2025-03-08 21:53:34 - INFO - [性能] 读取缓存文件耗时: 0.03秒
2025-03-08 21:53:34 - INFO - 缓存年龄: 3.6小时
2025-03-08 21:53:34 - INFO - [性能] 验证缓存耗时: 0.00秒
2025-03-08 21:53:34 - INFO - 缓存加载成功，总耗时: 0.03秒
2025-03-08 21:53:34 - INFO - ===== 缓存加载性能明细 =====
2025-03-08 21:53:34 - INFO - 读取缓存文件: 0.03秒
2025-03-08 21:53:34 - INFO - 验证缓存: 0.00秒
2025-03-08 21:53:34 - INFO - 总耗时: 0.03秒
2025-03-08 21:53:34 - INFO - =========================
2025-03-08 21:53:34 - INFO - [性能] 加载缓存耗时: 0.03秒
2025-03-08 21:53:34 - INFO - [性能] 恢复缓存数据耗时: 0.00秒
2025-03-08 21:53:34 - DEBUG - 缓存的表数量: 106
2025-03-08 21:53:34 - DEBUG - 缓存的schema长度: 145328
2025-03-08 21:53:34 - INFO - [性能] 创建表schema耗时: 0.00秒
2025-03-08 21:53:34 - DEBUG - 创建的表schema数量: 106
2025-03-08 21:53:34 - INFO - 重新计算表嵌入向量
2025-03-08 21:53:34 - INFO - 正在加载嵌入模型...
2025-03-08 21:53:34 - INFO - [性能] 加载嵌入模型并计算表嵌入向量耗时: 0.00秒
2025-03-08 21:53:34 - INFO - 成功提取0个表的嵌入向量
2025-03-08 21:53:34 - INFO - [性能] 创建表检索器总耗时: 0.00秒
2025-03-08 21:53:34 - INFO - [性能] 创建提示模板耗时: 0.00秒
2025-03-08 21:53:34 - INFO - 正在初始化SQLTableRetrieverQueryEngine...
2025-03-08 21:53:34 - DEBUG - SQLTableRetrieverQueryEngine初始化成功
2025-03-08 21:53:34 - INFO - [性能] 创建SQLTableRetrieverQueryEngine耗时: 0.00秒
2025-03-08 21:53:34 - INFO - ===== 引擎创建性能明细 =====
2025-03-08 21:53:34 - INFO - 创建表schema: 0.00秒
2025-03-08 21:53:34 - INFO - 创建表检索器: 0.00秒
2025-03-08 21:53:34 - INFO - └─ 加载嵌入模型和计算向量: 0.00秒
2025-03-08 21:53:34 - INFO - 创建提示模板: 0.00秒
2025-03-08 21:53:34 - INFO - 创建查询引擎: 0.00秒
2025-03-08 21:53:34 - INFO - 总耗时: 0.00秒
2025-03-08 21:53:34 - INFO - ============================
2025-03-08 21:53:34 - INFO - [性能] 创建查询引擎耗时: 0.01秒
2025-03-08 21:53:34 - INFO - 查询引擎从缓存加载完成，总耗时: 1.85秒
2025-03-08 21:53:34 - INFO - ===== 性能统计摘要 =====
2025-03-08 21:53:34 - INFO - 创建SQLDatabase: 1.81秒
2025-03-08 21:53:34 - INFO - 检查缓存: 0.00秒
2025-03-08 21:53:34 - INFO - 加载缓存: 0.03秒
2025-03-08 21:53:34 - INFO - 恢复缓存数据: 0.00秒
2025-03-08 21:53:34 - INFO - 创建查询引擎: 0.01秒
2025-03-08 21:53:34 - INFO - 总耗时: 1.85秒
2025-03-08 21:53:34 - INFO - ========================
2025-03-08 21:54:17 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:54:17 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:54:17 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:54:17 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:54:17 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:54:17 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:54:17 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:54:17 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:54:17 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:54:17 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:54:17 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:54:17 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:54:17 - DEBUG - 开始调用LLM...
2025-03-08 21:54:32 - INFO - [性能] LLM调用耗时: 15.54秒
2025-03-08 21:54:32 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 原始SQL长度: 434字符
2025-03-08 21:54:32 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:54:32 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:54:32 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:54:32 - DEBUG - [性能] SQL验证总耗时: 0.01秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:54:32 - DEBUG - SQL安全性验证通过
2025-03-08 21:54:32 - INFO - [性能] SQL验证耗时: 0.01秒
2025-03-08 21:54:32 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 获取连接池状态出错: 'str' object has no attribute 'get'
2025-03-08 21:54:32 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:54:32 - INFO - [性能] SQL执行耗时: 0.02秒
2025-03-08 21:54:32 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:54:32 - INFO - 选择相关表: 0.00秒
2025-03-08 21:54:32 - INFO - 构建schema: 0.00秒
2025-03-08 21:54:32 - INFO - 构建提示: 0.00秒
2025-03-08 21:54:32 - INFO - LLM调用: 15.54秒
2025-03-08 21:54:32 - INFO - SQL验证: 0.01秒
2025-03-08 21:54:32 - INFO - SQL执行: 0.02秒
2025-03-08 21:54:32 - INFO - 总耗时: 15.58秒
2025-03-08 21:54:32 - INFO - ===============================
2025-03-08 21:54:32 - INFO - [性能] LLM生成SQL耗时: 15.58秒
2025-03-08 21:54:32 - INFO - [性能] 查询总耗时: 15.58秒
2025-03-08 21:54:32 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:54:32 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:54:32 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:54:32 - DEBUG - SQL安全性验证通过
2025-03-08 21:54:32 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701';
2025-03-08 21:54:32 - DEBUG - 字段验证完成
2025-03-08 21:54:32 - INFO - [性能] SQL验证耗时: 0.03秒
2025-03-08 21:54:32 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701';", "result_size": 1294}
2025-03-08 21:54:32 - INFO - [性能] 查询处理总耗时: 15.61秒
2025-03-08 21:54:32 - INFO - ===== 查询性能明细 =====
2025-03-08 21:54:32 - INFO - LLM生成SQL: 15.58秒
2025-03-08 21:54:32 - INFO - SQL验证: 0.03秒
2025-03-08 21:54:32 - INFO - 总耗时: 15.61秒
2025-03-08 21:54:32 - INFO - =======================
2025-03-08 21:55:03 - INFO - 开始处理查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:55:03 - DEBUG - 发送到LLM的查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:55:03 - DEBUG - 执行查询: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:55:03 - INFO - 使用备选方法：直接通过LLM生成SQL
2025-03-08 21:55:03 - DEBUG - 为查询选择相关表: 查询产品编号为TC2024112701的送货明细
2025-03-08 21:55:03 - DEBUG - 通过关键词"送货明细"直接匹配到表: WmsDeliverynoteDetail
2025-03-08 21:55:03 - INFO - [性能] 选择相关表耗时: 0.00秒
2025-03-08 21:55:03 - INFO - [性能] 构建schema耗时: 0.00秒
2025-03-08 21:55:03 - DEBUG - 精简后的schema长度: 1003字符
2025-03-08 21:55:03 - INFO - [性能] 构建提示耗时: 0.00秒
2025-03-08 21:55:03 - DEBUG - 发送到LLM的提示开头:

        你是SQL Server专家，请将以下自然语言问题转换为SQL查询语句。

        数据库表结构:
        表名：WmsDeliverynoteDetail
表说明：送货单明细

字段列表：
- Id: 主键Id (bigint(19))
- DeliverynotMainCode:  (nvarchar(200))
- ERPId: erpid (int(10))
- ProductCode: 产品编号 (nvarchar(200))
- ProductName: 产品名称 (nvarchar(200))
- ProductSpecs: 产品规格 (nvarchar(200))
- ProductUnit: 产品单位 (nvarchar(200))
- ProductType: 产品类别 (nvarchar(200))
- PurchaseQnty: 采购数量 (decimal(18))
- DeliverynotQnty: 送货数量 (decimal(18))
- LotNo: 批次 (nvarchar(200))
- ProduceTime: 生...
2025-03-08 21:55:03 - DEBUG - 提示总长度: 1439字符
2025-03-08 21:55:03 - DEBUG - 开始调用LLM...
2025-03-08 21:55:17 - INFO - [性能] LLM调用耗时: 13.12秒
2025-03-08 21:55:17 - DEBUG - LLM返回的原始响应 [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 原始SQL长度: 433字符
2025-03-08 21:55:17 - DEBUG - 原始SQL字符代码: [83, 69, 76, 69, 67, 84, 32, 73, 100, 44, 32, 68, 101, 108, 105, 118, 101, 114, 121, 110]...
2025-03-08 21:55:17 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:55:17 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:55:17 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:55:17 - DEBUG - SQL安全性验证通过
2025-03-08 21:55:17 - INFO - [性能] SQL验证耗时: 0.00秒
2025-03-08 21:55:17 - DEBUG - 清理并验证后的SQL [完整]: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 开始执行SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 获取连接池状态出错: 'str' object has no attribute 'get'
2025-03-08 21:55:17 - DEBUG - SQL执行结果: ("[(618691322544197, 'SH202412031601235082', None, 'TC2024112701', '铜材', '2*2', '吨', '1', Decimal('2...
2025-03-08 21:55:17 - INFO - [性能] SQL执行耗时: 0.00秒
2025-03-08 21:55:17 - INFO - ===== SQL生成执行性能明细 =====
2025-03-08 21:55:17 - INFO - 选择相关表: 0.00秒
2025-03-08 21:55:17 - INFO - 构建schema: 0.00秒
2025-03-08 21:55:17 - INFO - 构建提示: 0.00秒
2025-03-08 21:55:17 - INFO - LLM调用: 13.12秒
2025-03-08 21:55:17 - INFO - SQL验证: 0.00秒
2025-03-08 21:55:17 - INFO - SQL执行: 0.00秒
2025-03-08 21:55:17 - INFO - 总耗时: 13.13秒
2025-03-08 21:55:17 - INFO - ===============================
2025-03-08 21:55:17 - INFO - [性能] LLM生成SQL耗时: 13.13秒
2025-03-08 21:55:17 - INFO - [性能] 查询总耗时: 13.13秒
2025-03-08 21:55:17 - DEBUG - LLM生成的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 开始验证SQL语句安全性: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 清理后的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:55:17 - DEBUG - 紧凑的SQL: SELECT Id, DeliverynotMainCode, ERPId, ProductCode...
2025-03-08 21:55:17 - DEBUG - [性能] SQL验证总耗时: 0.00秒 (清理: 0.00秒, 验证: 0.00秒)
2025-03-08 21:55:17 - DEBUG - SQL安全性验证通过
2025-03-08 21:55:17 - DEBUG - 开始验证SQL字段: SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete
FROM WmsDeliverynoteDetail
WHERE ProductCode = 'TC2024112701'
2025-03-08 21:55:17 - DEBUG - 字段验证完成
2025-03-08 21:55:17 - INFO - [性能] SQL验证耗时: 0.01秒
2025-03-08 21:55:17 - INFO - {"type": "query", "status": "success", "query": "查询产品编号为TC2024112701的送货明细", "sql": "SELECT Id, DeliverynotMainCode, ERPId, ProductCode, ProductName, ProductSpecs, ProductUnit, ProductType, PurchaseQnty, DeliverynotQnty, LotNo, ProduceTime, Bstate, ValidityPeriod, MaterialReceiptTime, SupplierTime, SupplierName, SupplierCode, Remark, CreateTime, UpdateTime, CreateUserId, CreateUserName, UpdateUserId, UpdateUserName, CreateOrgId, CreateOrgName, IsDelete\nFROM WmsDeliverynoteDetail\nWHERE ProductCode = 'TC2024112701'", "result_size": 1294}
2025-03-08 21:55:17 - INFO - [性能] 查询处理总耗时: 13.14秒
2025-03-08 21:55:17 - INFO - ===== 查询性能明细 =====
2025-03-08 21:55:17 - INFO - LLM生成SQL: 13.13秒
2025-03-08 21:55:17 - INFO - SQL验证: 0.01秒
2025-03-08 21:55:17 - INFO - 总耗时: 13.14秒
2025-03-08 21:55:17 - INFO - =======================
